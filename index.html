<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>STEPS – FETP Scale Up Decision Aid (India)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <div class="app-header-left">
      <div class="app-logo-circle">S</div>
      <div class="app-title-block">
        <h1>STEPS – FETP Scale Up Tool</h1>
        <p>Structured Testing of Epidemiology Programme Scenarios for India</p>
      </div>
    </div>
    <div class="app-header-right">
      <button id="startTourBtn" class="btn btn-soft">Take a 60-second tour</button>
    </div>
  </header>

  <main class="app-main">
    <aside class="app-sidebar">
      <section class="sidebar-card">
        <h2>Current configuration at a glance</h2>
        <dl class="summary-list">
          <div>
            <dt>Tier</dt>
            <dd id="summaryTier">–</dd>
          </div>
          <div>
            <dt>Incentive</dt>
            <dd id="summaryIncentive">–</dd>
          </div>
          <div>
            <dt>Mentorship</dt>
            <dd id="summaryMentorship">–</dd>
          </div>
          <div>
            <dt>Delivery</dt>
            <dd id="summaryDelivery">–</dd>
          </div>
          <div>
            <dt>Response time</dt>
            <dd id="summaryResponse">–</dd>
          </div>
          <div>
            <dt>Model</dt>
            <dd id="summaryModel">–</dd>
          </div>
          <div>
            <dt>Trainees / cohort</dt>
            <dd id="summaryTrainees">–</dd>
          </div>
          <div>
            <dt>Number of cohorts</dt>
            <dd id="summaryCohorts">–</dd>
          </div>
          <div>
            <dt>Cost / trainee / month</dt>
            <dd id="summaryCostPerTrainee">–</dd>
          </div>
          <div>
            <dt>Cost template</dt>
            <dd id="summaryTemplate">–</dd>
          </div>
          <div>
            <dt>Endorsement rate</dt>
            <dd id="summaryEndorsement">–</dd>
          </div>
        </dl>
      </section>

      <section class="sidebar-card">
        <h2>Headline recommendation</h2>
        <p id="headlineRecommendation">
          Adjust the configuration in the tabs to generate an evidence-based recommendation here.
        </p>
      </section>

      <section class="sidebar-card sidebar-mini-about">
        <h2>About STEPS</h2>
        <p>
          STEPS combines preference evidence from a discrete choice experiment with costing templates
          to support decisions on scaling FETP tiers in India.
        </p>
        <button class="btn btn-link" onclick="switchTab('about')">
          Read more about STEPS
        </button>
      </section>
    </aside>

    <section class="app-content">
      <nav class="tab-bar">
        <button class="tab-btn active" data-tab="intro">Introduction</button>
        <button class="tab-btn" data-tab="attributes">Attributes &amp; levels</button>
        <button class="tab-btn" data-tab="config">Configuration</button>
        <button class="tab-btn" data-tab="results">Results</button>
        <button class="tab-btn" data-tab="costing">Costing details</button>
        <button class="tab-btn" data-tab="simulation">National simulation</button>
        <button class="tab-btn" data-tab="saved">Saved scenarios</button>
        <button class="tab-btn" data-tab="advanced">Advanced settings</button>
        <button class="tab-btn" data-tab="methods">Methods &amp; technical appendix</button>
        <button class="tab-btn" data-tab="about">About STEPS</button>
      </nav>

      <!-- INTRO TAB -->
      <section class="tab-section active" id="tab-intro">
        <div class="tab-header">
          <h2>Introduction</h2>
          <p>
            STEPS is a policy decision aid for testing scale-up options for Field Epidemiology Training
            Programmes (FETP) in India. It links stakeholder preferences, programme costs and
            simple epidemiological multipliers.
          </p>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>What STEPS does</h3>
            <ul class="bullet-list">
              <li>Predicts endorsement of different FETP configurations (Frontline, Intermediate, Advanced).</li>
              <li>Combines endorsement with willingness-to-pay (WTP) to generate indicative economic benefits.</li>
              <li>Builds programme costs using templates from WHO, NIE and NCDC.</li>
              <li>Summarises benefit–cost ratios, net benefits and outbreak response capacity.</li>
            </ul>
          </div>

          <div class="card">
            <h3>How to use this tool</h3>
            <ol class="numbered-list">
              <li>Review <strong>Attributes &amp; levels</strong> to understand the design space.</li>
              <li>Use the <strong>Configuration</strong> tab to set tier, mentorship, delivery, response time and costs.</li>
              <li>Check <strong>Results</strong> for endorsement, WTP and economic metrics.</li>
              <li>Explore budget implications in <strong>Costing details</strong> and <strong>National simulation</strong>.</li>
              <li>Build a <strong>Saved portfolio</strong> of shortlisted scenarios and export to Excel or PDF.</li>
              <li>Consult the <strong>Methods &amp; technical appendix</strong> for full formulas and worked examples.</li>
            </ol>
          </div>
        </div>
      </section>

      <!-- ATTRIBUTES & LEVELS TAB -->
      <section class="tab-section" id="tab-attributes">
        <div class="tab-header">
          <h2>Attributes &amp; levels</h2>
          <p>
            The discrete choice experiment underlying STEPS uses the following programme attributes and
            levels. WTP estimates convert these attribute changes into indicative monetary values per
            trainee per month.
          </p>
        </div>

        <div class="card attribute-card">
          <h3>Programme tier</h3>
          <p>
            Captures the depth and duration of training. Higher tiers are longer and more intensive.
          </p>
          <table class="mini-table">
            <thead>
            <tr>
              <th>Level</th>
              <th>Description</th>
              <th>Indicative duration</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td>Frontline</td>
              <td>Short, practice-oriented training for local surveillance and response.</td>
              <td>3 months</td>
            </tr>
            <tr>
              <td>Intermediate</td>
              <td>Deeper analytical training for state and regional roles.</td>
              <td>12 months</td>
            </tr>
            <tr>
              <td>Advanced</td>
              <td>Full FETP training for national and leadership roles.</td>
              <td>24 months</td>
            </tr>
            </tbody>
          </table>
        </div>

        <div class="grid-two">
          <div class="card attribute-card">
            <h3>Career incentive</h3>
            <p>
              Captures credential and career progression value attached to the programme.
            </p>
            <ul class="bullet-list">
              <li><strong>Government &amp; partner certificate (reference)</strong> – recognised completion certificate.</li>
              <li><strong>University qualification</strong> – formal academic credential (e.g. diploma/degree component).</li>
              <li><strong>Government career pathway</strong> – explicit linkage to promotion or specialist posts.</li>
            </ul>
          </div>

          <div class="card attribute-card">
            <h3>Mentorship intensity</h3>
            <p>
              Amount and quality of supervision and support during training.
            </p>
            <ul class="bullet-list">
              <li><strong>Low</strong> – limited structured mentoring.</li>
              <li><strong>Medium</strong> – regular mentoring with some field support.</li>
              <li><strong>High</strong> – intensive, sustained mentoring and supervision.</li>
            </ul>
          </div>
        </div>

        <div class="grid-two">
          <div class="card attribute-card">
            <h3>Delivery mode</h3>
            <ul class="bullet-list">
              <li><strong>Blended (reference)</strong> – mix of in-person and online.</li>
              <li><strong>Fully in person</strong> – classroom and field-based teaching.</li>
              <li><strong>Fully online</strong> – remote learning with virtual support.</li>
            </ul>
          </div>

          <div class="card attribute-card">
            <h3>Outbreak response time</h3>
            <p>Maximum expected time to respond to outbreaks or signals.</p>
            <ul class="bullet-list">
              <li><strong>Within 30 days (reference)</strong></li>
              <li><strong>Within 15 days</strong></li>
              <li><strong>Within 7 days</strong></li>
            </ul>
          </div>
        </div>

        <div class="card attribute-card">
          <h3>Cost per trainee per month</h3>
          <p>
            Monthly cost per trainee in Indian rupees (INR), inclusive of training delivery. This enters
            the model as a negative coefficient and anchors the WTP calculations.
          </p>
        </div>

        <div class="card attribute-card">
          <h3>How to read WTP results</h3>
          <p>
            WTP is expressed in INR per trainee per month and reflects the average value stakeholders
            attach to moving from the reference levels to a given configuration. For example, a WTP of
            INR 120,000 per trainee per month means that, relative to a low-mentorship, certificate-only,
            blended, 30-day response baseline, stakeholders collectively value the enhanced configuration
            at around INR 120,000 per trainee per month of training time.
          </p>
        </div>
      </section>

      <!-- CONFIGURATION TAB -->
      <section class="tab-section" id="tab-config">
        <div class="tab-header">
          <h2>Configuration</h2>
          <p>
            Set up a candidate FETP configuration below. Each field includes a short explanation to
            support structured discussions with policy partners.
          </p>
        </div>

        <div class="card">
          <div class="config-grid">
            <div class="form-group">
              <label for="programmeTier">Programme tier</label>
              <select id="programmeTier">
                <option value="frontline">Frontline (3 months)</option>
                <option value="intermediate">Intermediate (12 months)</option>
                <option value="advanced">Advanced (24 months)</option>
              </select>
              <p class="field-help">
                Use this to compare shorter frontline training with longer Intermediate and Advanced
                options. Higher tiers increase both costs and outbreak response capacity.
              </p>
            </div>

            <div class="form-group">
              <label for="careerIncentive">Career incentive</label>
              <select id="careerIncentive">
                <option value="certificate">Govt &amp; partner certificate</option>
                <option value="university">University qualification</option>
                <option value="gov_pathway">Government career pathway</option>
              </select>
              <p class="field-help">
                Choose the main credential or progression benefit attached to the programme. Stronger
                incentives tend to increase endorsement and WTP.
              </p>
            </div>

            <div class="form-group">
              <label for="mentorship">Mentorship intensity</label>
              <select id="mentorship">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
              <p class="field-help">
                Higher mentorship supports better learning and retention. It typically raises endorsement
                but can increase overall delivery cost.
              </p>
            </div>

            <div class="form-group">
              <label for="deliveryMode">Delivery mode</label>
              <select id="deliveryMode">
                <option value="blended">Blended</option>
                <option value="inperson">Fully in person</option>
                <option value="online">Fully online</option>
              </select>
              <p class="field-help">
                Blended delivery balances flexibility and field exposure. Fully online may reduce costs but
                is less preferred by many stakeholders.
              </p>
            </div>

            <div class="form-group">
              <label for="responseTime">Outbreak response capacity</label>
              <select id="responseTime">
                <option value="30">Within 30 days</option>
                <option value="15">Within 15 days</option>
                <option value="7">Within 7 days</option>
              </select>
              <p class="field-help">
                Faster response times reflect stronger applied skills and integration with surveillance
                systems. Shorter response windows raise WTP and endorsement.
              </p>
            </div>

            <div class="form-group">
              <label for="prefModel">Preference model</label>
              <select id="prefModel">
                <option value="mxl">Average mixed logit (all stakeholders)</option>
                <option value="lc2">Latent Class 2 (training supporters)</option>
              </select>
              <p class="field-help">
                Use the mixed logit model for average preferences across all respondents, or the
                “supporters” latent class to focus on those most in favour of investing in FETP.
              </p>
            </div>

            <div class="form-group">
              <label for="traineesPerCohort">Trainees per cohort</label>
              <input id="traineesPerCohort" type="number" min="5" max="150" step="1" value="20">
              <p class="field-help">
                Use this to test smaller or larger cohort sizes. For example, moving from 20 to 30 trainees
                per cohort increases both costs and epidemiological benefits.
              </p>
            </div>

            <div class="form-group">
              <label for="numCohorts">Number of cohorts</label>
              <input id="numCohorts" type="number" min="1" max="100" step="1" value="6">
              <p class="field-help">
                Set how many cohorts will be trained under this configuration. More cohorts increase total
                cost but also expand the trained workforce.
              </p>
            </div>

            <div class="form-group">
              <label for="costTemplate">Cost template</label>
              <select id="costTemplate"></select>
              <p class="field-help">
                Choose a costing template (WHO, NIE, NCDC) that best reflects the delivery model you are
                testing. Templates determine the allocation of spending across cost categories.
              </p>
            </div>

            <div class="form-group">
              <label for="costPerTrainee">
                Cost per trainee per month
              </label>
              <input id="costPerTrainee" type="range" min="75000" max="400000" step="5000" value="150000">
              <div class="slider-label-row">
                <span>₹75k</span>
                <span id="costPerTraineeLabel">INR 150,000</span>
                <span>₹400k</span>
              </div>
              <p class="field-help">
                Use this slider to align with your current or target budget envelope. The tool projects how
                endorsement and economic returns change as unit cost varies.
              </p>
            </div>

            <div class="form-group">
              <label>Include trainee opportunity cost</label>
              <button id="oppCostToggle" type="button" class="toggle-btn">On</button>
              <p class="field-help">
                When “On”, the model adds an opportunity cost per trainee per month (set under Advanced
                settings) to reflect salary time dedicated to training instead of routine duties.
              </p>
            </div>
          </div>

          <div class="config-actions-row">
            <div class="config-actions-left">
              <button id="applyConfigBtn" class="btn btn-primary">Apply configuration</button>
              <button id="viewResultsBtn" class="btn btn-outline">View results summary</button>
              <button id="quickSaveScenarioBtn" class="btn btn-soft">Quick-save scenario</button>
            </div>
            <div class="config-actions-right">
              <div class="what-it-takes">
                <h3>“What would it take?”</h3>
                <div class="what-grid">
                  <div class="form-group mini">
                    <label for="targetEndorsement">Target endorsement (%)</label>
                    <input id="targetEndorsement" type="number" min="5" max="95" step="1" value="70">
                    <button id="solveEndorsementBtn" class="btn btn-soft btn-mini">Solve cost</button>
                  </div>
                  <div class="form-group mini">
                    <label for="targetBcr">Target benefit–cost ratio</label>
                    <input id="targetBcr" type="number" min="0.1" max="5" step="0.05" value="1.3">
                    <button id="solveBcrBtn" class="btn btn-soft btn-mini">Solve cost</button>
                  </div>
                </div>
                <p id="whatItTakesNote" class="field-help">
                  Set a target and solve for the cost per trainee per month required under the current
                  configuration.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- RESULTS TAB -->
      <section class="tab-section" id="tab-results">
        <div class="tab-header">
          <h2>Results – endorsement, WTP and economic outcomes</h2>
          <p>
            This tab summarises endorsement, willingness-to-pay (WTP), costs and benefits for the
            current configuration.
          </p>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Endorsement</h3>
            <p class="metric-number" id="metricEndorse">–</p>
            <p class="metric-sub">Would choose this FETP configuration</p>
            <p class="metric-foot">
              The remaining share choose the opt-out option instead of this configuration.
            </p>
          </div>

          <div class="card metric-card">
            <h3>Opt out</h3>
            <p class="metric-number" id="metricOptout">–</p>
            <p class="metric-sub">Would prefer not to invest in this option</p>
          </div>

          <div class="card metric-card">
            <h3>WTP per trainee per month</h3>
            <p class="metric-number" id="metricWtp">–</p>
            <p class="metric-sub">Indicative value placed on this configuration</p>
            <p class="metric-foot" id="metricWtpExplanation">
              WTP reflects how much value stakeholders attach to the attributes of this configuration,
              relative to a basic baseline, per trainee per month.
            </p>
          </div>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Graduates (all cohorts)</h3>
            <p class="metric-number" id="metricGraduates">–</p>
            <p class="metric-sub">After adjusting for completion rates</p>
          </div>
          <div class="card metric-card">
            <h3>Outbreak responses per year</h3>
            <p class="metric-number" id="metricOutbreaks">–</p>
            <p class="metric-sub">Based on graduates and response multipliers</p>
          </div>
          <div class="card metric-card">
            <h3>Benefit–cost ratio</h3>
            <p class="metric-number" id="metricBcr">–</p>
            <p class="metric-sub">Total benefits ÷ total costs</p>
          </div>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Total programme cost</h3>
            <p class="metric-number" id="metricTotalCost">–</p>
            <p class="metric-sub">All cohorts, including opportunity cost (if on)</p>
          </div>
          <div class="card metric-card">
            <h3>Total indicative benefit</h3>
            <p class="metric-number" id="metricTotalBenefit">–</p>
          </div>
          <div class="card metric-card">
            <h3>Net benefit</h3>
            <p class="metric-number" id="metricNetBenefit">–</p>
            <p class="metric-sub">Total benefit − total cost</p>
          </div>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>Endorsement and opt out</h3>
            <canvas id="endorsementChart" height="220"></canvas>
          </div>
          <div class="card">
            <h3>Cost vs benefit per cohort</h3>
            <canvas id="costBenefitChart" height="220"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="briefing-header">
            <h3>Briefing text (copy into emails or reports)</h3>
            <button class="btn btn-outline" onclick="openResultsModal()">View full scenario summary</button>
          </div>
          <textarea id="briefingText" rows="6"></textarea>
        </div>
      </section>

      <!-- COSTING DETAILS TAB -->
      <section class="tab-section" id="tab-costing">
        <div class="tab-header">
          <h2>Costing details</h2>
          <p>
            This tab explains how total programme cost per cohort is constructed from the selected cost
            template and optional opportunity cost.
          </p>
        </div>

        <div class="card">
          <h3>Template and totals</h3>
          <p><strong>Cost template:</strong> <span id="costTemplateName">–</span></p>

          <div class="grid-three metrics-grid skinny">
            <div>
              <h4>Programme cost per cohort</h4>
              <p class="metric-number small" id="programmeCostLabel">–</p>
            </div>
            <div>
              <h4>Opportunity cost per cohort</h4>
              <p class="metric-number small" id="oppCostLabel">–</p>
            </div>
            <div>
              <h4>Total cost per cohort</h4>
              <p class="metric-number small" id="totalCostPerCohortLabel">–</p>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Cost breakdown by category</h3>
          <p class="field-help">
            The table below allocates programme cost per cohort across key categories using the shares
            in the selected template. Opportunity cost is shown separately if included.
          </p>
          <div class="table-wrapper">
            <table id="costComponentsTable" class="data-table">
              <thead>
              <tr>
                <th>Category</th>
                <th>Amount (INR)</th>
              </tr>
              </thead>
              <tbody>
              <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- NATIONAL SIMULATION TAB -->
      <section class="tab-section" id="tab-simulation">
        <div class="tab-header">
          <h2>National simulation</h2>
          <p>
            This tab extends the current configuration to national totals using the number of trainees
            and cohorts specified in the Configuration tab.
          </p>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Graduates (all cohorts)</h3>
            <p class="metric-number" id="simGraduates">–</p>
          </div>
          <div class="card metric-card">
            <h3>Total programme cost</h3>
            <p class="metric-number" id="simTotalCost">–</p>
          </div>
          <div class="card metric-card">
            <h3>Total indicative benefit</h3>
            <p class="metric-number" id="simTotalBenefit">–</p>
          </div>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Net benefit</h3>
            <p class="metric-number" id="simNetBenefit">–</p>
          </div>
          <div class="card metric-card">
            <h3>Outbreak responses per year</h3>
            <p class="metric-number" id="simOutbreaks">–</p>
          </div>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>Cost, benefit and net benefit</h3>
            <canvas id="simChart" height="240"></canvas>
          </div>
          <div class="card">
            <h3>Cost sensitivity of benefit–cost ratio</h3>
            <canvas id="sensitivityChart" height="240"></canvas>
          </div>
        </div>
      </section>

      <!-- SAVED SCENARIOS TAB -->
      <section class="tab-section" id="tab-saved">
        <div class="tab-header">
          <h2>Saved scenarios and portfolio</h2>
          <p>
            Use this tab to store, compare and export candidate configurations for discussion with
            national and state-level partners.
          </p>
        </div>

        <div class="card">
          <h3>Save the current configuration</h3>
          <div class="config-grid">
            <div class="form-group">
              <label for="scenarioName">Scenario name</label>
              <input id="scenarioName" type="text" placeholder="e.g. Advanced high-mentorship NIE costs">
              <p class="field-help">
                Give each scenario a short, descriptive name that will make sense in a policy brief.
              </p>
            </div>
            <div class="form-group">
              <label for="scenarioTags">Tags (semicolon separated)</label>
              <input id="scenarioTags" type="text" placeholder="e.g. national; priority; high mentorship">
              <p class="field-help">
                Tags help organise scenarios, for example by target states, funding source or priority level.
              </p>
            </div>
            <div class="form-group">
              <label for="scenarioNotes">Notes</label>
              <textarea id="scenarioNotes" rows="2" placeholder="Key assumptions, caveats or discussion notes."></textarea>
            </div>
          </div>
          <button id="saveScenarioBtn" class="btn btn-primary">Save scenario with details</button>
        </div>

        <div class="card">
          <h3>Saved scenarios table</h3>
          <p class="field-help">
            Use the “Shortlist” checkbox to mark up to five scenarios for inclusion in exported briefs.
          </p>
          <div class="table-wrapper">
            <table id="savedScenariosTable" class="data-table">
              <thead>
              <tr>
                <th>Shortlist</th>
                <th>Name</th>
                <th>Tags</th>
                <th>Tier</th>
                <th>Mentorship</th>
                <th>Delivery</th>
                <th>Response</th>
                <th>Cohorts</th>
                <th>Endorsement</th>
                <th>BCR</th>
                <th>Total cost (INR)</th>
                <th>Total benefit (INR)</th>
                <th>Notes</th>
              </tr>
              </thead>
              <tbody>
              <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>

          <div class="saved-actions-row">
            <button id="downloadExcelBtn" class="btn btn-outline">Download scenarios to Excel</button>
            <button id="downloadPdfBtn" class="btn btn-primary">Download policy brief (PDF)</button>
          </div>
        </div>

        <div class="card">
          <h3>Shortlisted portfolio (up to 5 scenarios)</h3>
          <p class="field-help">
            This grid summarises shortlisted scenarios for rapid comparison and review in meetings.
          </p>
          <div id="shortlistGrid" class="shortlist-grid">
            <!-- Filled dynamically -->
          </div>
        </div>
      </section>

      <!-- ADVANCED SETTINGS TAB -->
      <section class="tab-section" id="tab-advanced">
        <div class="tab-header">
          <h2>Advanced settings and assumptions</h2>
          <p>
            Adjust these parameters to align STEPS with country-specific data or alternative modelling
            assumptions. All changes are logged in the assumption snapshot.
          </p>
        </div>

        <div class="card">
          <div class="config-grid">
            <div class="form-group">
              <label for="completionRate">Completion rate (%)</label>
              <input id="completionRate" type="number" min="10" max="100" step="1" value="80">
              <p class="field-help">
                Proportion of enrolled trainees expected to graduate. This directly scales the number of
                graduates and outbreak responses.
              </p>
            </div>

            <div class="form-group">
              <label for="multiplierResponses">Outbreak responses per graduate per year</label>
              <input id="multiplierResponses" type="number" min="0" max="100" step="0.1" value="3">
              <p class="field-help">
                Expected number of outbreak investigations or major response contributions each graduate
                makes per year on average.
              </p>
            </div>

            <div class="form-group">
              <label for="valuePerResponse">Value per outbreak response (INR)</label>
              <input id="valuePerResponse" type="number" min="0" step="10000" value="500000">
              <p class="field-help">
                Economic value assigned to each outbreak response, reflecting averted illness, deaths and
                wider system benefits.
              </p>
            </div>

            <div class="form-group">
              <label for="oppCostPerMonth">Opportunity cost per trainee per month (INR)</label>
              <input id="oppCostPerMonth" type="number" min="0" step="1000" value="40000">
              <p class="field-help">
                Monthly salary cost of trainees while participating in FETP rather than performing usual
                duties. Used when the opportunity cost toggle is “On”.
              </p>
            </div>

            <div class="form-group">
              <label for="exchangeRate">INR to USD exchange rate</label>
              <input id="exchangeRate" type="number" min="1" step="0.1" value="85">
              <p class="field-help">
                Used for internal cross-checks and to support reporting in USD if required. Does not
                affect core endorsement or WTP calculations.
              </p>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Assumption snapshot</h3>
          <p class="field-help">
            Every time you change an advanced parameter, the snapshot is updated with a timestamp. This
            can be pasted into reports to document key assumptions.
          </p>
          <pre id="assumptionLog" class="assumption-log"></pre>
        </div>
      </section>

      <!-- METHODS & TECHNICAL APPENDIX TAB -->
      <section class="tab-section" id="tab-methods">
        <div class="tab-header">
          <h2>Methods &amp; technical appendix</h2>
          <p>
            This appendix documents the underlying preference models, cost and benefit calculations,
            and how STEPS maps them into endorsement, WTP, benefit and cost metrics.
          </p>
        </div>

        <div class="card">
          <h3>1. Preference models and utility specification</h3>
          <p>
            STEPS uses two models estimated on the FETP–India discrete choice experiment:
          </p>
          <ul class="bullet-list">
            <li>
              A mixed logit (MXL) model in preference space with random parameters for key attributes and
              a log-normally distributed cost coefficient.
            </li>
            <li>
              A two-class latent class model, with Class 2 representing “training supporters” who are
              systematically more favourable to investing in FETP.
            </li>
          </ul>
          <p>
            For any programme configuration, the systematic utility of the FETP option is:
          </p>
          <pre class="code-block">
V<sub>program</sub> = ASC<sub>Program</sub>
               + β<sub>tier</sub>(tier)
               + β<sub>career</sub>(career incentive)
               + β<sub>mentor</sub>(mentorship)
               + β<sub>delivery</sub>(delivery mode)
               + β<sub>resp</sub>(response time)
               + β<sub>cost</sub> · (cost per trainee per month / 1000)</pre>
          <p>
            The opt-out alternative has a utility
            <code>V<sub>opt-out</sub> = ASC<sub>OptOut</sub></code>. The endorsement probability is:
          </p>
          <pre class="code-block">
P(endorse FETP) =
  exp(V<sub>program</sub>) / [exp(V<sub>program</sub>) + exp(V<sub>opt-out</sub>)]</pre>
          <p>
            In the tool, this is computed in the <code>computeEndorsement()</code> function using the
            coefficients selected via the “Preference model” dropdown.
          </p>
        </div>

        <div class="card">
          <h3>2. Willingness-to-pay (WTP) calculations</h3>
          <p>
            WTP is calculated from the mixed logit and latent class models by dividing each attribute
            coefficient by the cost coefficient, yielding values in thousand INR per trainee per month.
            For a given configuration, STEPS:
          </p>
          <ol class="numbered-list">
            <li>Selects the relevant WTP table (mixed logit or Class 2).</li>
            <li>Retrieves the WTP associated with the chosen tier, incentive, mentorship, delivery and response time.</li>
            <li>Sums these WTP contributions to obtain total WTP in thousand INR per trainee per month.</li>
            <li>Multiplies by 1,000 to express WTP in INR per trainee per month.</li>
          </ol>
          <p>
            This total is reported as “WTP per trainee per month” in the Results tab and is used to
            construct indicative benefits:
          </p>
          <pre class="code-block">
WTP<sub>config</sub> (INR / trainee / month)
  = Σ WTP<sub>attribute level</sub> × 1000</pre>
          <p>
            Intuitively, this tells you how much value stakeholders attach to moving from a basic,
            low-mentorship, certificate-only, 30-day response programme to the selected configuration.
          </p>
        </div>

        <div class="card">
          <h3>3. Cost calculations</h3>
          <p>
            Costs are built in three steps for each cohort:
          </p>
          <ol class="numbered-list">
            <li>
              <strong>Programme cost per cohort:</strong>
              <code>cost per trainee per month × duration (months) × trainees per cohort</code>.
            </li>
            <li>
              <strong>Opportunity cost per cohort (optional):</strong>
              <code>opp. cost per trainee per month × duration × trainees per cohort</code>, included only when
              the opportunity cost toggle is “On”.
            </li>
            <li>
              <strong>Total cost per cohort:</strong> sum of the two components above.
            </li>
          </ol>
          <p>
            Total cost across all cohorts is then:
          </p>
          <pre class="code-block">
Total cost (all cohorts) =
  total cost per cohort × number of cohorts</pre>
          <p>
            Within each cohort, the selected cost template (WHO, NIE, NCDC) is used to allocate programme
            cost across categories such as staff, workshops, travel and management. The opportunity cost
            appears as a separate line item in the cost breakdown.
          </p>
        </div>

        <div class="card">
          <h3>4. Benefit calculations and WTP-based CBA</h3>
          <p>
            The core economic benefit measure is constructed by combining WTP with programme scale and
            endorsement:
          </p>
          <ol class="numbered-list">
            <li>
              <strong>Graduates per cohort:</strong>
              <code>trainees per cohort × completion rate</code>.
            </li>
            <li>
              <strong>Endorsed graduates:</strong> graduates per cohort × endorsement probability.
            </li>
            <li>
              <strong>Benefit per cohort:</strong>
              <code>WTP per trainee per month × duration (months) × endorsed graduates per cohort</code>.
            </li>
            <li>
              <strong>Total benefit (all cohorts):</strong>
              benefit per cohort × number of cohorts.
            </li>
          </ol>
          <p>
            Benefit–cost ratio (BCR) and net benefit are then:
          </p>
          <pre class="code-block">
BCR = Total benefit / Total cost

Net benefit = Total benefit − Total cost</pre>
          <p>
            These are reported in both the Results and National simulation tabs and used to generate
            policy-ready text in the briefing and PDF export.
          </p>
        </div>

        <div class="card">
          <h3>5. Outbreak response multipliers and epidemiological benefits</h3>
          <p>
            STEPS also tracks a simple epidemiological output: projected outbreak responses per year.
            This is calculated as:
          </p>
          <pre class="code-block">
Graduates (all cohorts)
  = trainees per cohort × completion rate × number of cohorts

Outbreak responses per year
  = graduates (all cohorts)
    × responses per graduate per year
    × endorsement probability</pre>
          <p>
            Multiplying this by “Value per outbreak response (INR)” yields an epidemiological benefit
            measure that can be compared with the WTP-based benefit.
          </p>
        </div>

        <div class="card">
          <h3>6. Worked example (illustrative)</h3>
          <p>
            Consider an Intermediate tier programme with university qualification, high mentorship,
            blended delivery and 15-day response time, costing INR 150,000 per trainee per month,
            30 trainees per cohort, 10 cohorts, 80% completion rate, 3 responses per graduate per year
            and value per response of INR 500,000.
          </p>
          <ul class="bullet-list">
            <li>Endorsement probability might be, for example, 65% based on the preference model.</li>
            <li>Graduates per cohort: 30 × 0.8 = 24.</li>
            <li>Total graduates: 24 × 10 = 240.</li>
            <li>If WTP per trainee per month is INR 120,000, benefit per cohort is:
              120,000 × 12 × 24 × 0.65 ≈ INR 22.5 million.</li>
            <li>With 10 cohorts, total benefit ≈ INR 225 million.</li>
            <li>If total cost is INR 150 million, BCR ≈ 1.5 and net benefit ≈ INR 75 million.</li>
          </ul>
          <p>
            These numbers are illustrative but show how the tool translates configurations into
            transparent, reproducible benefit and cost metrics.
          </p>
        </div>
      </section>

      <!-- ABOUT STEPS TAB -->
      <section class="tab-section" id="tab-about">
        <div class="tab-header">
          <h2>About STEPS</h2>
          <p>
            STEPS (Structured Testing of Epidemiology Programme Scenarios) is part of a broader effort
            to develop a business case for strengthening and scaling FETP programmes in India.
          </p>
        </div>

        <div class="card">
          <h3>Purpose and partnerships</h3>
          <p>
            The University of Newcastle is developing a business case for strengthening and scaling
            FETP programmes in India. STEPS is one of the tools in this work. It provides a structured
            way to test scale-up options and explain cost and benefit implications in policy discussions.
          </p>
          <p>
            The tool is designed to support the Government of India, WHO, the World Bank and other
            partners as they plan investments in epidemiology training.
          </p>
        </div>

        <div class="card">
          <h3>Policy questions STEPS can inform</h3>
          <ul class="bullet-list">
            <li>
              <strong>Tier choices:</strong> How do costs and benefits change when moving from Frontline
              to Intermediate or Advanced tiers?
            </li>
            <li>
              <strong>Mentorship investments:</strong> What happens to endorsement when mentorship intensity
              is increased?
            </li>
            <li>
              <strong>Scale objectives:</strong> How many cohorts and trainees are needed to reach target
              national scale under different configurations?
            </li>
            <li>
              <strong>Budget envelopes:</strong> For a given budget, which combinations of tier, mentorship
              and response capacity provide the strongest benefits?
            </li>
          </ul>
        </div>

        <div class="card">
          <h3>Acknowledgements and contact</h3>
          <p>
            Prepared by <strong>Mesfin Genie, PhD</strong>, Newcastle Business School, The University of
            Newcastle, Australia.
          </p>
          <p>
            For questions or clarifications please contact:
            <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>.
          </p>
        </div>
      </section>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <!-- Results modal -->
  <div id="resultsModal" class="modal hidden">
    <div class="modal-dialog">
      <button id="closeResultsModal" class="modal-close">&times;</button>
      <h2>Scenario summary</h2>
      <div id="modalScenarioSummary"></div>
    </div>
  </div>

  <!-- Tour modal -->
  <div id="tourModal" class="modal hidden">
    <div class="modal-dialog modal-dialog-small">
      <button id="closeTourModal" class="modal-close">&times;</button>
      <h2 id="tourTitle">Welcome to STEPS</h2>
      <div id="tourBody" class="tour-body"></div>
      <div class="modal-actions">
        <button id="tourSkipBtn" class="btn btn-soft">Skip</button>
        <button id="tourNextBtn" class="btn btn-primary">Next</button>
      </div>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
