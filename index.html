<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>STEPS FETP Scale Up Decision Aid (India) - Version 1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <div class="app-header-left">
      <div class="app-logo-circle">S</div>
      <div class="app-title-block">
        <h1>STEPS</h1>
        <p>Scalable Training Estimation and Planning System for FETP India</p>
      </div>
    </div>
    <div class="app-header-right">
      <span class="version-badge">Version 1.0</span>
      <button id="startTourBtn" class="btn btn-soft">Take a 60-second tour</button>
    </div>
  </header>

  <main class="app-main">
    <aside class="app-sidebar">
      <section class="sidebar-card sidebar-mini-about">
        <h2>What is STEPS?</h2>
        <p>
          STEPS combines discrete choice experiment evidence with cost templates to help decision makers
          compare Field Epidemiology Training Programme (FETP) scale up options in India.
        </p>
        <button class="btn btn-link" onclick="switchTab('about')">
          Read more about STEPS
        </button>
      </section>

      <section class="sidebar-card">
        <h2>Quick guide</h2>
        <ul class="bullet-list">
          <li>Check <strong>Attributes &amp; levels</strong> for the design space.</li>
          <li>Use <strong>Configuration</strong> to set up a scenario.</li>
          <li>Read <strong>Results</strong> for endorsement, WTP, costs and benefits.</li>
          <li>Build a <strong>Saved portfolio</strong> for policy briefs.</li>
        </ul>
      </section>

      <section class="sidebar-card">
        <h2>Help and methods</h2>
        <p class="sidebar-small">
          Advanced parameters and methods are documented in the
          <strong>Advanced settings</strong> and <strong>Methods &amp; technical appendix</strong> tabs.
          A full technical appendix can be opened in a separate window for detailed review.
        </p>
        <button id="openAppendixSidebarBtn" class="btn btn-outline btn-small">
          Open full technical appendix
        </button>
      </section>
    </aside>

    <section class="app-content">
      <nav class="tab-bar">
        <button class="tab-btn active" data-tab="intro">Introduction</button>
        <button class="tab-btn" data-tab="attributes">Attributes &amp; levels</button>
        <button class="tab-btn" data-tab="config">Configuration</button>
        <button class="tab-btn" data-tab="results">Results</button>
        <button class="tab-btn" data-tab="costing">Costing details</button>
        <button class="tab-btn" data-tab="simulation">National simulation</button>
        <button class="tab-btn" data-tab="saved">Saved scenarios</button>
        <button class="tab-btn" data-tab="advanced">Advanced settings</button>
        <button class="tab-btn" data-tab="methods">Methods &amp; technical appendix</button>
        <button class="tab-btn" data-tab="about">About STEPS</button>
      </nav>

      <!-- INTRO TAB -->
      <section class="tab-section active" id="tab-intro">
        <div class="tab-header">
          <h2>Introduction</h2>
          <p>
            STEPS is a decision support tool for policy makers planning investment in Field Epidemiology
            Training Programmes (FETP) in India. It links stakeholder preferences, programme costs and
            simple epidemiological multipliers.
          </p>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>What STEPS provides</h3>
            <ul class="bullet-list">
              <li>Predicted endorsement of different FETP designs (Frontline, Intermediate, Advanced).</li>
              <li>Willingness-to-pay (WTP) estimates in INR per trainee per month.</li>
              <li>Programme costs, benefits, benefit–cost ratios and net benefits.</li>
              <li>Simple outbreak response outputs using epidemiological multipliers.</li>
            </ul>
          </div>

          <div class="card">
            <h3>How to read this tool</h3>
            <ol class="numbered-list">
              <li>Use <strong>Attributes &amp; levels</strong> to see what can change in FETP design.</li>
              <li>Set a scenario in the <strong>Configuration</strong> tab and apply it.</li>
              <li>Review endorsement, WTP, costs and benefits in <strong>Results</strong>.</li>
              <li>Check how costs are built in <strong>Costing details</strong>.</li>
              <li>Look at national totals in <strong>National simulation</strong>.</li>
              <li>Save options in <strong>Saved scenarios</strong> and export Excel/PDF.</li>
            </ol>
          </div>
        </div>
      </section>

      <!-- ATTRIBUTES & LEVELS TAB -->
      <section class="tab-section" id="tab-attributes">
        <div class="tab-header">
          <h2>Attributes &amp; levels</h2>
          <p>
            The discrete choice experiment that underpins STEPS uses the attributes and levels below.
            These are translated into endorsement probabilities and willingness-to-pay (WTP) values.
          </p>
        </div>

        <div class="card">
          <h3>Summary of attributes</h3>
          <div class="table-wrapper">
            <table class="attr-table">
              <thead>
              <tr>
                <th>Attribute</th>
                <th>Levels</th>
                <th>Explanation</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td><strong>Programme tier</strong></td>
                <td>
                  <div class="levels-list">
                    <span><strong>Frontline</strong> - 3 months</span>
                    <span><strong>Intermediate</strong> - 12 months</span>
                    <span><strong>Advanced</strong> – 24 months</span>
                  </div>
                </td>
                <td>Captures depth and duration of training, from local frontline skills to national leadership roles.</td>
              </tr>
              <tr>
                <td><strong>Career incentive</strong></td>
                <td>
                  <div class="levels-list">
                    <span>Government &amp; partner certificate (reference)</span>
                    <span>University qualification</span>
                    <span>Government career pathway</span>
                  </div>
                </td>
                <td>Describes the main credential or promotion pathway associated with FETP.</td>
              </tr>
              <tr>
                <td><strong>Mentorship intensity</strong></td>
                <td>
                  <div class="levels-list">
                    <span>Low</span>
                    <span>Medium</span>
                    <span>High</span>
                  </div>
                </td>
                <td>Amount and quality of supervision, coaching and field support during training.</td>
              </tr>
              <tr>
                <td><strong>Delivery mode</strong></td>
                <td>
                  <div class="levels-list">
                    <span>Blended (reference)</span>
                    <span>Fully in person</span>
                    <span>Fully online</span>
                  </div>
                </td>
                <td>Balance between classroom, field-based and online learning.</td>
              </tr>
              <tr>
                <td><strong>Outbreak response time</strong></td>
                <td>
                  <div class="levels-list">
                    <span>Within 30 days (reference)</span>
                    <span>Within 15 days</span>
                    <span>Within 7 days</span>
                  </div>
                </td>
                <td>Maximum expected time to respond to outbreaks.</td>
              </tr>
              <tr>
                <td><strong>Cost per trainee per month</strong></td>
                <td>
                  <div class="levels-list">
                    <span>Continuous in INR (e.g. ₹75k – ₹400k)</span>
                  </div>
                </td>
                <td>Monthly cost per trainee.</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>How WTP is used</h3>
            <p>
              WTP is calculated from the models in thousand INR per trainee per month for each level.
              For a chosen configuration, STEPS adds the WTP contributions from tier, incentive,
              mentorship, delivery and response time, and then multiplies by 1,000 to express total
              WTP in INR per trainee per month.
            </p>
            <p class="field-help">
              Example: If moving from a basic to an Intermediate, high-mentorship programme with faster
              response yields a combined WTP of 120 (thousand INR), the tool reports WTP of INR 120,000
              per trainee per month.
            </p>
          </div>

          <div class="card">
            <h3>How to interpret WTP for policy</h3>
            <p>
              WTP values are not direct budgets. They provide a consistent way to compare options:
              configurations with higher WTP are more valued by stakeholders, all else equal. When
              combined with cost, WTP can highlight where stronger designs justify higher investment.
            </p>
          </div>
        </div>
      </section>

      <!-- CONFIGURATION TAB -->
      <section class="tab-section" id="tab-config">
        <div class="tab-header">
          <h2>Configuration</h2>
          <p>
            Choose a FETP configuration, apply it, then review endorsement, WTP, costs and benefits in
            the Results and Simulation tabs. 
          </p>
        </div>

        <!-- CURRENT CONFIG + HEADLINE INSIDE CONFIG TAB -->
        <div class="grid-two config-summary-row">
          <div class="card">
            <div class="card-header-with-icon">
              <h3>Current configuration at a glance</h3>
              <span class="info-icon" title="Summary of the scenario defined in the fields below.">
                ⓘ
              </span>
            </div>
            <dl class="summary-list">
              <div>
                <dt>Program tier</dt>
                <dd id="summaryTier">Frontline (3 months)</dd>
              </div>
              <div>
                <dt>Career incentive</dt>
                <dd id="summaryIncentive">Government and partner certificate</dd>
              </div>
              <div>
                <dt>Mentorship</dt>
                <dd id="summaryMentorship">Low</dd>
              </div>
              <div>
                <dt>Mode of delivery</dt>
                <dd id="summaryDelivery">Blended</dd>
              </div>
              <div>
                <dt>Response time</dt>
                <dd id="summaryResponse">Within 30 days</dd>
              </div>
              <div>
                <dt>Model</dt>
                <dd id="summaryModel">Average mixed logit</dd>
              </div>
              <div>
                <dt>Trainees per cohort</dt>
                <dd id="summaryTrainees">20</dd>
              </div>
              <div>
                <dt>Number of cohorts</dt>
                <dd id="summaryCohorts">6</dd>
              </div>
              <div>
                <dt>Cost per trainee per month</dt>
                <dd id="summaryCostPerTrainee">INR 150,000</dd>
              </div>
              <div>
                <dt>Cost template</dt>
                <dd id="summaryTemplate">Frontline - WHO template (6 cohorts)</dd>
              </div>
              <div>
                <dt>Endorsement rate</dt>
                <dd id="summaryEndorsement">–</dd>
              </div>
            </dl>
          </div>

          <div class="card">
            <div class="card-header-with-icon">
              <h3>Headline recommendation</h3>
              <span class="info-icon" title="Plain language summary for policy discussions based on the current configuration.">
                ⓘ
              </span>
            </div>
            <p id="headlineRecommendation" class="headline-text">
              Adjust the configuration in the fields below to generate an evidence-based
              recommendation here.
            </p>
          </div>
        </div>

        <div class="card">
          <div class="config-grid">
            <div class="form-group">
              <label for="programmeTier">
                Programme tier
                <span class="info-icon" title="From short frontline courses to full Advanced FETP.">ⓘ</span>
              </label>
              <select id="programmeTier">
                <option value="frontline">Frontline (3 months)</option>
                <option value="intermediate">Intermediate (12 months)</option>
                <option value="advanced">Advanced (24 months)</option>
              </select>
              <p class="field-help">
                Use this to compare shorter frontline training with longer Intermediate and Advanced
                options. Higher tiers increase both costs and outbreak response capacity.
              </p>
            </div>

            <div class="form-group">
              <label for="careerIncentive">
                Career incentive
                <span class="info-icon" title="Certificate, university qualification, or explicit career pathway.">ⓘ</span>
              </label>
              <select id="careerIncentive">
                <option value="certificate">Govt &amp; partner certificate</option>
                <option value="university">University qualification</option>
                <option value="gov_pathway">Government career pathway</option>
              </select>
              <p class="field-help">
                Choose the main credential or progression benefit attached to the programme.
              </p>
            </div>

            <div class="form-group">
              <label for="mentorship">
                Mentorship intensity
                <span class="info-icon" title="Higher mentorship supports learning but costs more.">ⓘ</span>
              </label>
              <select id="mentorship">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
              <p class="field-help">
                Higher mentorship typically raises endorsement and improves quality but increases cost.
              </p>
            </div>

            <div class="form-group">
              <label for="deliveryMode">
                Delivery mode
                <span class="info-icon" title="Blended, fully in-person or fully online.">ⓘ</span>
              </label>
              <select id="deliveryMode">
                <option value="blended">Blended</option>
                <option value="inperson">Fully in person</option>
                <option value="online">Fully online</option>
              </select>
              <p class="field-help">
                Blended delivery balances flexibility and field exposure. Fully online may reduce costs
                but is less preferred in the DCE.
              </p>
            </div>

            <div class="form-group">
              <label for="responseTime">
                Outbreak response capacity
                <span class="info-icon" title="Maximum expected time to respond to outbreaks.">ⓘ</span>
              </label>
              <select id="responseTime">
                <option value="30">Within 30 days</option>
                <option value="15">Within 15 days</option>
                <option value="7">Within 7 days</option>
              </select>
              <p class="field-help">
                Faster response times reflect stronger applied skills and tighter integration with
                surveillance systems.
              </p>
            </div>

            <div class="form-group">
              <label for="prefModel">
                Preference model
                <span class="info-icon" title="Average model or the more supportive latent class.">ⓘ</span>
              </label>
              <select id="prefModel">
                <option value="mxl">Mixed logit (all stakeholders)</option>
                <option value="lc2">Latent Class 2 (training supporters)</option>
              </select>
              <p class="field-help">
                Use the mixed logit model for average preferences across all respondents, or the
                “supporters” latent class to focus on those most in favour of investing in FETP.
              </p>
            </div>

            <div class="form-group">
              <label for="traineesPerCohort">
                Trainees per cohort
                <span class="info-icon" title="Number of trainees enrolled in each cohort.">ⓘ</span>
              </label>
              <input id="traineesPerCohort" type="number" min="5" max="150" step="1" value="20">
              <p class="field-help">
                Use this to test smaller or larger cohort sizes. For example, increasing from 20 to 30
                trainees per cohort raises both costs and epidemiological benefits.
              </p>
            </div>

            <div class="form-group">
              <label for="numCohorts">
                Number of cohorts
                <span class="info-icon" title="How many cohorts will follow this configuration.">ⓘ</span>
              </label>
              <input id="numCohorts" type="number" min="1" max="100" step="1" value="6">
              <p class="field-help">
                Set how many cohorts will be trained under this configuration.
              </p>
            </div>

            <div class="form-group">
              <label for="costTemplate">
                Cost template
                <span class="info-icon" title="WHO, NIE or NCDC cost patterns, depending on tier.">ⓘ</span>
              </label>
              <select id="costTemplate"></select>
              <p class="field-help">
                Choose a costing template that best matches the delivery model you are testing.
              </p>
            </div>

            <div class="form-group">
              <label for="costPerTrainee">
                Cost per trainee per month
                <span class="info-icon" title="Unit cost used in the DCE and cost calculations.">ⓘ</span>
              </label>
              <input id="costPerTrainee" type="range" min="75000" max="400000" step="5000" value="150000">
              <div class="slider-label-row">
                <span>₹75k</span>
                <span id="costPerTraineeLabel">INR 150,000</span>
                <span>₹400k</span>
              </div>
              <p class="field-help">
                Adjust this to reflect your budget. The tool shows how endorsement and economic
                returns change as unit cost varies.
              </p>
            </div>

            <div class="form-group">
              <label>
                Include trainee opportunity cost
                <span class="info-icon" title="Salary cost of trainees while in training.">ⓘ</span>
              </label>
              <button id="oppCostToggle" type="button" class="toggle-btn">On</button>
              <p class="field-help">
                When “On”, the model adds an opportunity cost per trainee per month (set under Advanced
                settings) to reflect salary time dedicated to training instead of routine duties.
              </p>
            </div>
          </div>

          <div class="config-actions-row">
            <div class="config-actions-left">
              <button id="applyConfigBtn" class="btn btn-primary">Apply configuration</button>
              <button id="viewResultsBtn" class="btn btn-outline">View results summary</button>
              <button id="quickSaveScenarioBtn" class="btn btn-soft">Save scenario</button>
            </div>
            <div class="config-actions-right">
              <div class="what-it-takes">
                <div class="card-header-with-icon">
                  <h3>“What would it take?”</h3>
                  <span class="info-icon" title="Solve for the cost that delivers a target endorsement or BCR.">ⓘ</span>
                </div>
                <div class="what-grid">
                  <div class="form-group mini">
                    <label for="targetEndorsement">Target endorsement (%)</label>
                    <input id="targetEndorsement" type="number" min="5" max="95" step="1" value="70">
                    <button id="solveEndorsementBtn" class="btn btn-soft btn-mini">Solve cost</button>
                  </div>
                  <div class="form-group mini">
                    <label for="targetBcr">Target benefit–cost ratio</label>
                    <input id="targetBcr" type="number" min="0.1" max="5" step="0.05" value="1.3">
                    <button id="solveBcrBtn" class="btn btn-soft btn-mini">Solve cost</button>
                  </div>
                </div>
                <p id="whatItTakesNote" class="field-help">
                  Set a target and solve for the cost per trainee per month required under the current
                  configuration.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- RESULTS TAB -->
      <section class="tab-section" id="tab-results">
        <div class="tab-header">
          <h2>Results – endorsement, WTP and economic outcomes</h2>
          <p>
            This tab summarises endorsement, willingness-to-pay (WTP), costs and benefits for the
            current configuration.
          </p>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Endorsement</h3>
            <p class="metric-number" id="metricEndorse">–</p>
            <p class="metric-sub">Would choose this FETP configuration</p>
            <p class="metric-foot">
              The remaining share choose the opt-out option instead.
            </p>
          </div>

          <div class="card metric-card">
            <h3>Opt out</h3>
            <p class="metric-number" id="metricOptout">–</p>
            <p class="metric-sub">Would prefer not to invest in this option</p>
          </div>

          <div class="card metric-card">
            <h3>WTP per trainee per month</h3>
            <p class="metric-number" id="metricWtp">–</p>
            <p class="metric-sub">Indicative value placed on this configuration</p>
            <p class="metric-foot" id="metricWtpExplanation">
              WTP reflects how much value stakeholders attach to the attributes of this configuration,
              relative to a basic baseline, per trainee per month.
            </p>
          </div>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Graduates (all cohorts)</h3>
            <p class="metric-number" id="metricGraduates">–</p>
            <p class="metric-sub">After adjusting for completion rates</p>
          </div>
          <div class="card metric-card">
            <h3>Outbreak responses per year</h3>
            <p class="metric-number" id="metricOutbreaks">–</p>
            <p class="metric-sub">Based on graduates and response multipliers</p>
          </div>
          <div class="card metric-card">
            <h3>Benefit per cohort</h3>
            <p class="metric-number" id="metricBenefitPerCohort">–</p>
            <p class="metric-sub">WTP-based benefit for one cohort</p>
          </div>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Total programme cost</h3>
            <p class="metric-number" id="metricTotalCost">–</p>
            <p class="metric-sub">All cohorts, including opportunity cost (if on)</p>
          </div>
          <div class="card metric-card">
            <h3>Total indicative benefit</h3>
            <p class="metric-number" id="metricTotalBenefit">–</p>
          </div>
          <div class="card metric-card">
            <h3>Benefit–cost ratio</h3>
            <p class="metric-number" id="metricBcr">–</p>
            <p class="metric-sub">Total benefits ÷ total costs</p>
          </div>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Net benefit</h3>
            <p class="metric-number" id="metricNetBenefit">–</p>
            <p class="metric-sub">Total benefit − total cost</p>
          </div>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>Endorsement and opt out</h3>
            <canvas id="endorsementChart" height="220"></canvas>
          </div>
          <div class="card">
            <h3>Cost vs benefit per cohort</h3>
            <canvas id="costBenefitChart" height="220"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="briefing-header">
            <h3>Briefing text (copy into emails or reports)</h3>
            <button class="btn btn-outline" onclick="openResultsModal()">View full scenario summary</button>
          </div>
          <textarea id="briefingText" rows="6"></textarea>
        </div>
      </section>

      <!-- COSTING DETAILS TAB -->
      <section class="tab-section" id="tab-costing">
        <div class="tab-header">
          <h2>Costing details</h2>
          <p>
            This tab explains how total programme cost per cohort is constructed from the selected cost
            template and optional opportunity cost.
          </p>
        </div>

        <div class="card">
          <div class="card-header-with-icon">
            <h3>Template and totals</h3>
            <span class="info-icon" title="Programme cost, trainee opportunity cost and total cost per cohort.">ⓘ</span>
          </div>
          <p><strong>Cost template:</strong> <span id="costTemplateName">–</span></p>

          <div class="grid-three metrics-grid skinny">
            <div>
              <h4>Programme cost per cohort</h4>
              <p class="metric-number small" id="programmeCostLabel">–</p>
            </div>
            <div>
              <h4>Opportunity cost per cohort</h4>
              <p class="metric-number small" id="oppCostLabel">–</p>
            </div>
            <div>
              <h4>Total cost per cohort</h4>
              <p class="metric-number small" id="totalCostPerCohortLabel">–</p>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header-with-icon">
            <h3>Cost breakdown by category</h3>
            <span class="info-icon" title="Allocation of programme cost across key cost categories.">ⓘ</span>
          </div>
          <p class="field-help">
            The table below allocates programme cost per cohort across key categories using the shares
            in the selected template. Opportunity cost is shown separately if included.
          </p>
          <div class="table-wrapper">
            <table id="costComponentsTable" class="data-table">
              <thead>
              <tr>
                <th>Category</th>
                <th>Amount (INR)</th>
              </tr>
              </thead>
              <tbody>
              <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- NATIONAL SIMULATION TAB -->
      <section class="tab-section" id="tab-simulation">
        <div class="tab-header">
          <h2>National simulation</h2>
          <p>
            This tab extends the current configuration to national totals using the number of trainees
            and cohorts specified in the Configuration tab.
          </p>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Graduates (all cohorts)</h3>
            <p class="metric-number" id="simGraduates">–</p>
          </div>
          <div class="card metric-card">
            <h3>Total programme cost</h3>
            <p class="metric-number" id="simTotalCost">–</p>
          </div>
          <div class="card metric-card">
            <h3>Total indicative benefit</h3>
            <p class="metric-number" id="simTotalBenefit">–</p>
          </div>
        </div>

        <div class="grid-three metrics-grid">
          <div class="card metric-card">
            <h3>Net benefit</h3>
            <p class="metric-number" id="simNetBenefit">–</p>
          </div>
          <div class="card metric-card">
            <h3>Outbreak responses per year</h3>
            <p class="metric-number" id="simOutbreaks">–</p>
          </div>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>Cost, benefit and net benefit</h3>
            <canvas id="simChart" height="240"></canvas>
          </div>
          <div class="card">
            <h3>Cost sensitivity of benefit–cost ratio</h3>
            <canvas id="sensitivityChart" height="240"></canvas>
          </div>
        </div>
      </section>

      <!-- SAVED SCENARIOS TAB -->
      <section class="tab-section" id="tab-saved">
        <div class="tab-header">
          <h2>Saved scenarios and portfolio</h2>
          <p>
            Use this tab to store, compare and export candidate configurations for discussion with
            national and state-level partners.
          </p>
        </div>

        <div class="card">
          <h3>Save the current configuration</h3>
          <div class="config-grid">
            <div class="form-group">
              <label for="scenarioName">Scenario name</label>
              <input id="scenarioName" type="text" placeholder="e.g. Advanced high-mentorship NIE costs">
              <p class="field-help">
                Give each scenario a short, descriptive name that will make sense in a policy brief.
              </p>
            </div>
            <div class="form-group">
              <label for="scenarioTags">Tags (semicolon separated)</label>
              <input id="scenarioTags" type="text" placeholder="e.g. national; priority; high mentorship">
              <p class="field-help">
                Tags help organise scenarios, for example by target states, funding source or priority level.
              </p>
            </div>
            <div class="form-group">
              <label for="scenarioNotes">Notes</label>
              <textarea id="scenarioNotes" rows="2" placeholder="Key assumptions, caveats or discussion notes."></textarea>
            </div>
          </div>
          <button id="saveScenarioBtn" class="btn btn-primary">Save scenario with details</button>
        </div>

        <div class="card">
          <h3>Saved scenarios table</h3>
          <p class="field-help">
            Use the “Shortlist” checkbox to mark up to five scenarios for inclusion in exported briefs.
          </p>
          <div class="table-wrapper">
            <table id="savedScenariosTable" class="data-table">
              <thead>
              <tr>
                <th>Shortlist</th>
                <th>Name</th>
                <th>Tags</th>
                <th>Tier</th>
                <th>Mentorship</th>
                <th>Delivery</th>
                <th>Response</th>
                <th>Cohorts</th>
                <th>Endorsement</th>
                <th>BCR</th>
                <th>Total cost (INR)</th>
                <th>Total benefit (INR)</th>
                <th>Notes</th>
              </tr>
              </thead>
              <tbody>
              <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>

          <div class="saved-actions-row">
            <button id="downloadExcelBtn" class="btn btn-outline">Download scenarios to Excel</button>
            <button id="downloadPdfBtn" class="btn btn-primary">Download policy brief (PDF)</button>
          </div>
        </div>

        <div class="card">
          <h3>Shortlisted portfolio (up to 5 scenarios)</h3>
          <p class="field-help">
            This grid summarises shortlisted scenarios for rapid comparison and review in meetings.
          </p>
          <div id="shortlistGrid" class="shortlist-grid">
            <!-- Filled dynamically -->
          </div>
        </div>
      </section>

      <!-- ADVANCED SETTINGS TAB -->
      <section class="tab-section" id="tab-advanced">
        <div class="tab-header">
          <h2>Advanced settings and assumptions</h2>
          <p>
            Adjust these parameters to align STEPS with country-specific data or alternative modelling
            assumptions. All changes are logged in the assumption snapshot.
          </p>
        </div>

        <div class="card">
          <div class="config-grid">
            <div class="form-group">
              <label for="completionRate">
                Completion rate (%)
                <span class="info-icon" title="Proportion of enrolled trainees expected to graduate.">ⓘ</span>
              </label>
              <input id="completionRate" type="number" min="10" max="100" step="1" value="80">
              <p class="field-help">
                This directly scales the number of graduates and outbreak responses.
              </p>
            </div>

            <div class="form-group">
              <label for="multiplierResponses">
                Outbreak responses per graduate per year
                <span class="info-icon" title="Average number of outbreaks or major responses per graduate per year.">ⓘ</span>
              </label>
              <input id="multiplierResponses" type="number" min="0" max="100" step="0.1" value="3">
              <p class="field-help">
                Used to convert numbers of graduates into expected outbreak responses.
              </p>
            </div>

            <div class="form-group">
              <label for="valuePerResponse">
                Value per outbreak response (INR)
                <span class="info-icon" title="Economic value assigned to each outbreak response.">ⓘ</span>
              </label>
              <input id="valuePerResponse" type="number" min="0" step="10000" value="500000">
              <p class="field-help">
                Reflects averted illness, deaths and wider system benefits per response.
              </p>
            </div>

            <div class="form-group">
              <label for="oppCostPerMonth">
                Opportunity cost per trainee per month (INR)
                <span class="info-icon" title="Salary cost of trainee time while in training.">ⓘ</span>
              </label>
              <input id="oppCostPerMonth" type="number" min="0" step="1000" value="40000">
              <p class="field-help">
                Used when the opportunity cost toggle is “On”.
              </p>
            </div>

            <div class="form-group">
              <label for="exchangeRate">
                INR to USD exchange rate
                <span class="info-icon" title="For reporting in USD if needed; does not change core model.">ⓘ</span>
              </label>
              <input id="exchangeRate" type="number" min="1" step="0.1" value="85">
              <p class="field-help">
                Supports optional conversion of results into USD for external reporting.
              </p>
            </div>
          </div>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3>Assumption snapshot</h3>
            <p class="field-help">
              Every time you change an advanced parameter, the snapshot is updated with a timestamp.
              This can be pasted into reports to document key assumptions.
            </p>
            <pre id="assumptionLog" class="assumption-log"></pre>
          </div>

          <div class="card">
            <h3>Technical appendix</h3>
            <p>
              The technical appendix explains how STEPS uses discrete choice experiment estimates,
              cost templates and epidemiological multipliers. It includes numerical examples based on
              the mixed logit and latent class models and the willingness-to-pay results.
            </p>
            <p>
              Open the full appendix in a separate window for easier reading or printing.
            </p>
            <button id="openAppendixAdvancedBtn" class="btn btn-outline">Open full technical appendix</button>
          </div>
        </div>
      </section>

      <!-- METHODS & TECHNICAL APPENDIX TAB -->
      <section class="tab-section" id="tab-methods">
        <div class="tab-header">
          <h2>Methods &amp; technical appendix</h2>
          <p>
            This section summarises the main elements of the underlying models. A separate, longer
            technical appendix can be opened for detailed review.
          </p>
        </div>

        <div class="card">
          <h3>1. Preference models and utility</h3>
          <p>
            STEPS uses a mixed logit model and a two-class latent class model estimated using the FETP–India
            discrete choice experiment. For any programme configuration, the systematic utility of the
            FETP option is:
          </p>
          <pre class="code-block">
V_program =
  ASC_Program
  + β_tier(tier)
  + β_career(career incentive)
  + β_mentor(mentorship)
  + β_delivery(delivery mode)
  + β_response(response time)
  + β_cost · (cost per trainee per month / 1000)</pre>
          <p>
            The opt-out option has utility <code>V_optout = ASC_OptOut</code>. The endorsement
            probability is:
          </p>
          <pre class="code-block">
P(endorse FETP) =
  exp(V_program) / [exp(V_program) + exp(V_optout)]</pre>
          <p>
            The <strong>Results</strong> tab reports this as “Endorsement”, with the complement reported
            as “Opt out”.
          </p>
        </div>

        <div class="card">
          <h3>2. WTP calculations with worked example</h3>
          <p>
            WTP is calculated by dividing attribute coefficients by the cost coefficient (expressed per
            thousand INR). For a given configuration, STEPS:
          </p>
          <ol class="numbered-list">
            <li>Selects the relevant WTP table (mixed logit or latent Class 2).</li>
            <li>Retrieves the WTP values (in thousand INR) associated with the chosen tier, incentive, mentorship, delivery and response time.</li>
            <li>Sums these values and multiplies by 1,000 to obtain WTP in INR per trainee per month.</li>
          </ol>
          <p><strong>Illustrative example</strong> (numbers for illustration only):</p>
          <ul class="bullet-list">
            <li>Intermediate tier: 47 (thousand INR)</li>
            <li>High mentorship: 137 (thousand INR)</li>
            <li>Blended delivery: 0 (reference)</li>
            <li>Response within 15 days: 117 (thousand INR)</li>
            <li>Career incentive (university qualification): 4 (thousand INR)</li>
          </ul>
          <p>
            Total WTP = (47 + 137 + 0 + 117 + 4) × 1,000 = INR 305,000 per trainee per month.
          </p>
        </div>

        <div class="card">
          <h3>3. Cost calculations with worked example</h3>
          <p>
            Costs are built in three steps for each cohort:
          </p>
          <ol class="numbered-list">
            <li>
              <strong>Programme cost per cohort:</strong>
              <code>cost per trainee per month × duration (months) × trainees per cohort</code>.
            </li>
            <li>
              <strong>Opportunity cost per cohort (optional):</strong>
              <code>opp. cost per trainee per month × duration × trainees</code>.
            </li>
            <li>
              <strong>Total cost per cohort:</strong>
              programme cost + opportunity cost.
            </li>
          </ol>
          <p><strong>Illustrative example</strong> (Intermediate tier):</p>
          <ul class="bullet-list">
            <li>Cost per trainee per month = INR 150,000.</li>
            <li>Duration = 12 months; trainees per cohort = 20.</li>
            <li>Programme cost per cohort = 150,000 × 12 × 20 = INR 36,000,000.</li>
            <li>If opportunity cost is INR 40,000 per trainee per month, opp. cost per cohort = 40,000 × 12 × 20 = INR 9,600,000.</li>
            <li>Total cost per cohort = 45,600,000.</li>
          </ul>
          <p>
            Total cost across all cohorts is this value multiplied by the number of cohorts.
          </p>
        </div>

        <div class="card">
          <h3>4. Benefit calculations and benefit–cost analysis</h3>
          <p>
            Benefit is constructed by combining WTP with scale and endorsement:
          </p>
          <ol class="numbered-list">
            <li>Graduates per cohort = trainees per cohort × completion rate.</li>
            <li>Endorsed graduates per cohort = graduates per cohort × endorsement probability.</li>
            <li>Benefit per cohort = WTP per trainee per month × duration × endorsed graduates.</li>
            <li>Total benefit (all cohorts) = benefit per cohort × number of cohorts.</li>
          </ol>
          <p><strong>Illustrative example</strong>, continuing the case above:</p>
          <ul class="bullet-list">
            <li>Completion rate = 80 percent → graduates per cohort = 20 × 0.8 = 16.</li>
            <li>Endorsement probability = 0.56 → endorsed graduates ≈ 9.0.</li>
            <li>WTP per trainee per month = INR 305,000; duration = 12 months.</li>
            <li>Benefit per cohort ≈ 305,000 × 12 × 9.0 ≈ INR 32.9 million.</li>
            <li>With 6 cohorts, total benefit ≈ INR 197.4 million.</li>
          </ul>
          <p>
            If total cost across all cohorts is INR 273.6 million, the benefit–cost ratio is 197.4 / 273.6 ≈ 0.72
            and net benefit is −INR 76.2 million.
          </p>
        </div>

        <div class="card">
          <h3>5. Epidemiological multipliers</h3>
          <p>
            STEPS also tracks outbreak responses per year:
          </p>
          <pre class="code-block">
Graduates (all cohorts) =
  trainees per cohort × completion rate × cohorts

Outbreak responses per year =
  graduates (all cohorts)
  × responses per graduate per year
  × endorsement probability</pre>
          <p>
            Multiplying this by “Value per outbreak response (INR)” gives an epidemiological benefit
            measure that can be compared with WTP-based benefits.
          </p>
        </div>

        <div class="card">
          <h3>6. Open the full technical appendix</h3>
          <p>
            The full appendix sets out the mixed logit and latent class models, cost templates and
            epidemiological multipliers used in STEPS. Worked examples show how endorsement, costs,
            benefits and national scale up results are calculated.
          </p>
          <button id="openAppendixMethodsBtn" class="btn btn-outline">Open full technical appendix</button>
        </div>
      </section>

      <!-- ABOUT STEPS TAB -->
      <section class="tab-section" id="tab-about">
        <div class="tab-header">
          <h2>About STEPS</h2>
          <p>
            STEPS (Scalable Training Estimation and Planning System) is part of a broader effort
            to develop a business case for strengthening and scaling FETP programmes in India.
          </p>
        </div>

        <div class="card">
          <h3>Purpose and partnerships</h3>
          <p>
            The University of Newcastle is developing a business case for strengthening and scaling
            FETP programmes in India. STEPS is one of the tools in this work. It provides a structured
            way to test scale up options and explain cost and benefit implications in policy discussions.
          </p>
          <p>
            The tool is designed to support the Government of India and other
            partners as they plan investments in epidemiology training.
          </p>
        </div>

        <div class="card">
          <h3>Policy questions STEPS can inform</h3>
          <ul class="bullet-list">
            <li>
              <strong>Tier choices:</strong> How do costs and benefits change when moving from Frontline
              to Intermediate or Advanced tiers?
            </li>
            <li>
              <strong>Mentorship investments:</strong> What happens to endorsement when mentorship
              intensity is increased?
            </li>
            <li>
              <strong>Scale objectives:</strong> How many cohorts and trainees are needed to reach target
              national scale under different configurations?
            </li>
            <li>
              <strong>Budget envelopes:</strong> For a given budget, which combinations of tier, mentorship
              and response capacity provide the strongest returns?
            </li>
          </ul>
        </div>

        <div class="card">
          <h3>Acknowledgements and contact</h3>
          <p>
            Prepared by <strong>Mesfin Genie, PhD</strong>, Newcastle Business School, The University of
            Newcastle, Australia.
          </p>
          <p>
            For questions or clarifications please contact:
            <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>.
          </p>
        </div>
      </section>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <!-- Results modal -->
  <div id="resultsModal" class="modal hidden">
    <div class="modal-dialog">
      <button id="closeResultsModal" class="modal-close">&times;</button>
      <h2>Scenario summary</h2>
      <div id="modalScenarioSummary"></div>
    </div>
  </div>

  <!-- Tour modal -->
  <div id="tourModal" class="modal hidden">
    <div class="modal-dialog modal-dialog-small">
      <button id="closeTourModal" class="modal-close">&times;</button>
      <h2 id="tourTitle">Welcome to STEPS</h2>
      <div id="tourBody" class="tour-body"></div>
      <div class="modal-actions">
        <button id="tourSkipBtn" class="btn btn-soft">Skip</button>
        <button id="tourNextBtn" class="btn btn-primary">Next</button>
      </div>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
