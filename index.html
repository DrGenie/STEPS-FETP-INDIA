<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>STEPS – FETP Scale Up Decision Aid (India)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="styles.css">

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <div class="brand-block">
      <div class="brand-logo">S</div>
      <div class="brand-text">
        <div class="brand-title">STEPS</div>
        <div class="brand-subtitle">Scalable Training Estimation and Planning System – India FETP</div>
      </div>
    </div>
    <button class="tour-btn" id="startTourBtn">Quick tour</button>
  </header>

  <nav class="tab-bar">
    <button class="tab-btn active" data-tab="intro">Introduction</button>
    <button class="tab-btn" data-tab="config">Configuration</button>
    <button class="tab-btn" data-tab="results">Results</button>
    <button class="tab-btn" data-tab="costing">Costing details</button>
    <button class="tab-btn" data-tab="attributes">Attributes and levels</button>
    <button class="tab-btn" data-tab="simulation">National simulation and sensitivity</button>
    <button class="tab-btn" data-tab="saved">Saved scenarios</button>
    <button class="tab-btn" data-tab="advanced">Advanced and methods</button>
  </nav>

  <main class="tab-container">

    <!-- INTRO TAB -->
    <section id="tab-intro" class="tab-section active">
      <div class="panel-grid">
        <section class="card">
          <h2>What STEPS does</h2>
          <p>
            STEPS helps Indian decision makers explore different ways of scaling up Field Epidemiology
            Training Programs (FETPs). It combines:
          </p>
          <ul>
            <li>Stakeholder preferences from a discrete choice experiment (DCE).</li>
            <li>Cost templates for frontline, intermediate and advanced FETPs.</li>
            <li>Simple epidemiological multipliers for trained epidemiologists and outbreak response.</li>
          </ul>
          <p>
            Users can configure programme designs, see expected endorsement, costs and benefits,
            compare short listed scenarios, and export Excel and PDF reports for meetings and
            business cases.
          </p>
        </section>

        <section class="card">
          <h2>How to use the tool</h2>
          <ol class="numbered">
            <li>Go to the <strong>Configuration</strong> tab and choose programme tier, mentorship, response time, delivery mode, number of cohorts, cohort size and cost per trainee per month.</li>
            <li>Keep the cost slider within the range used in the experiment (75,000 to 400,000 rupees per trainee per month).</li>
            <li>Select the preference model: <strong>Average mixed logit</strong> or the <strong>supportive latent class group</strong>.</li>
            <li>Click <strong>Apply configuration</strong> and then <strong>View results</strong> to see a modal summary with headline recommendations.</li>
            <li>Save promising scenarios in the <strong>Saved scenarios</strong> tab and download them as Excel or a policy brief PDF for reporting.</li>
            <li>Use the <strong>Advanced and methods</strong> tab to view and adjust key multipliers, exchange rates, and detailed methods if you are running a technical workshop.</li>
          </ol>
        </section>

        <section class="card">
          <h2>About the underlying study</h2>
          <p>
            Results are based on a DCE of 214 stakeholders in India, covering programme tier,
            career incentives, mentorship intensity, delivery mode, outbreak response capacity, and
            cost per trainee per month. Mixed logit and two class latent class models were
            estimated in Stata with a lognormal cost coefficient. Willingness to pay estimates and
            latent class results are used to map programme features into indicative economic
            benefits and endorsement.
          </p>
          <p class="small">
            For full econometric details and references, see the <strong>Advanced and methods</strong> tab.
          </p>
        </section>
      </div>
    </section>

    <!-- CONFIG TAB -->
    <section id="tab-config" class="tab-section">
      <div class="panel-grid two-col">
        <section class="card">
          <h2>Configure FETP programme</h2>

          <div class="field-row">
            <label for="programmeTier">
              Programme tier
              <span class="info-icon" data-tooltip="Frontline is a 3 month basic tier, Intermediate is a 12 month tier, and Advanced is a 24 month leadership tier. Durations are used for cost calculations.">i</span>
            </label>
            <select id="programmeTier">
              <option value="frontline">Frontline (3 months)</option>
              <option value="intermediate">Intermediate (12 months)</option>
              <option value="advanced">Advanced (24 months)</option>
            </select>
          </div>

          <div class="field-row">
            <label for="careerIncentive">
              Career incentive
              <span class="info-icon" data-tooltip="Type of credential or pathway that trainees receive after completion.">i</span>
            </label>
            <select id="careerIncentive">
              <option value="certificate">Government and partner certificate</option>
              <option value="university">University qualification</option>
              <option value="gov_pathway">Government career pathway</option>
            </select>
          </div>

          <div class="field-row">
            <label for="mentorship">
              Mentorship intensity
              <span class="info-icon" data-tooltip="Number of fellows per mentor, capturing how intensively trainees are supported.">i</span>
            </label>
            <select id="mentorship">
              <option value="low">Low (5 or more fellows per mentor)</option>
              <option value="medium">Medium (3 to 4 fellows per mentor)</option>
              <option value="high">High (2 or fewer fellows per mentor)</option>
            </select>
          </div>

          <div class="field-row">
            <label for="deliveryMode">
              Delivery mode
              <span class="info-icon" data-tooltip="Whether learning is mainly in person, online, or blended. Blended is the reference level in the DCE.">i</span>
            </label>
            <select id="deliveryMode">
              <option value="blended">Blended</option>
              <option value="inperson">Fully in person</option>
              <option value="online">Fully online</option>
            </select>
          </div>

          <div class="field-row">
            <label for="responseTime">
              Response time after training
              <span class="info-icon" data-tooltip="How quickly FETP graduates can detect and respond to outbreaks after training, linked to the 7 1 7 target.">i</span>
            </label>
            <select id="responseTime">
              <option value="30">Within 30 days</option>
              <option value="15">Within 15 days</option>
              <option value="7">Within 7 days</option>
            </select>
          </div>

          <div class="field-row">
            <label for="prefModel">
              Preference model
              <span class="info-icon" data-tooltip="Average mixed logit uses mean coefficients across all stakeholders. The supportive group uses the Class 2 latent class, representing training supporters with coherent cost sensitivity. Class 1 reflects training resisters who are cost insensitive and whose WTP is not reliable for policy.">i</span>
            </label>
            <select id="prefModel">
              <option value="mxl">Average mixed logit</option>
              <option value="lc2">Supportive latent class group</option>
            </select>
          </div>

          <div class="field-row">
            <label for="costPerTrainee">
              Cost per trainee per month (INR)
              <span class="info-icon" data-tooltip="This should remain within the experimental range 75,000 to 400,000 rupees per trainee per month. It drives utility, endorsement and all economic calculations.">i</span>
            </label>
            <input type="range" id="costPerTrainee" min="75000" max="400000" step="5000" value="165000">
            <div class="range-value">
              <span id="costPerTraineeLabel">INR 165,000</span>
            </div>
          </div>

          <div class="field-row">
            <label for="traineesPerCohort">
              Trainees per cohort
              <span class="info-icon" data-tooltip="Number of trainees enrolled in each cohort at the chosen tier. Together with programme duration and cost per trainee per month this determines total cost per cohort.">i</span>
            </label>
            <input type="number" id="traineesPerCohort" min="5" max="100" value="20">
          </div>

          <div class="field-row">
            <label for="numCohorts">
              Number of cohorts
              <span class="info-icon" data-tooltip="Number of cohorts you plan to run at this configuration across India. This drives national totals for graduates, costs and benefits.">i</span>
            </label>
            <input type="number" id="numCohorts" min="1" max="200" value="10">
          </div>

          <div class="field-row">
            <label for="costTemplate">
              Cost template source
              <span class="info-icon" data-tooltip="Determines the structure of costs based on actual templates. For frontline we use WHO data. For intermediate we use WHO, NIE or NCDC templates separately. For advanced we use NIE or NCDC templates. The template provides cost shares by component and is scaled to match the configured total cohort cost.">i</span>
            </label>
            <select id="costTemplate">
              <!-- options filled dynamically -->
            </select>
          </div>

          <div class="field-row toggle-row">
            <span>Include trainee opportunity cost</span>
            <span class="info-icon" data-tooltip="If turned on, the tool adds an estimate of trainee salary that could have been earned during training. Figures are based on the costing templates and can be adjusted in Advanced and methods.">i</span>
            <button id="oppCostToggle" class="toggle-btn" aria-pressed="true">On</button>
          </div>

          <div class="config-actions">
            <button id="applyConfigBtn" class="primary-btn">Apply configuration</button>
            <button id="viewResultsBtn" class="secondary-btn">View results</button>
            <button id="quickSaveScenarioBtn" class="secondary-btn">Save scenario</button>
          </div>
        </section>

        <section class="card">
          <h2>Current configuration at a glance</h2>
          <dl class="config-summary">
            <div>
              <dt>Programme tier</dt>
              <dd id="summaryTier">Frontline (3 months)</dd>
            </div>
            <div>
              <dt>Career incentive</dt>
              <dd id="summaryIncentive">Government and partner certificate</dd>
            </div>
            <div>
              <dt>Mentorship</dt>
              <dd id="summaryMentorship">Low</dd>
            </div>
            <div>
              <dt>Delivery mode</dt>
              <dd id="summaryDelivery">Blended</dd>
            </div>
            <div>
              <dt>Response time</dt>
              <dd id="summaryResponse">Within 30 days</dd>
            </div>
            <div>
              <dt>Preference model</dt>
              <dd id="summaryModel">Average mixed logit</dd>
            </div>
            <div>
              <dt>Trainees per cohort</dt>
              <dd id="summaryTrainees">20</dd>
            </div>
            <div>
              <dt>Number of cohorts</dt>
              <dd id="summaryCohorts">10</dd>
            </div>
            <div>
              <dt>Cost per trainee per month</dt>
              <dd id="summaryCostPerTrainee">INR 165,000</dd>
            </div>
            <div>
              <dt>Cost template</dt>
              <dd id="summaryTemplate">Frontline - WHO template</dd>
            </div>
          </dl>

          <h3>Headline recommendation</h3>
          <p id="headlineRecommendation" class="headline-text">
            At current cost and design, both net benefits and endorsement are modest. Consider moving towards Intermediate or Advanced with stronger mentorship or reducing costs before scaling up.
          </p>

          <div class="what-it-takes">
            <h3>What would it take</h3>
            <p class="small">
              These helpers adjust only the cost per trainee per month while holding all other settings and multipliers constant.
              The endorsement solver uses the logit equation with current attribute coefficients and the opt out constant.
              The benefit cost ratio solver uses a simple search over the cost slider to find a cost that produces the requested ratio.
            </p>
            <div class="field-row-inline">
              <label for="targetEndorsement">Target endorsement (%)</label>
              <input type="number" id="targetEndorsement" min="10" max="95" value="70">
              <button id="solveEndorsementBtn" class="tiny-btn">Solve cost for target endorsement</button>
            </div>
            <div class="field-row-inline">
              <label for="targetBcr">Target benefit cost ratio</label>
              <input type="number" id="targetBcr" step="0.1" min="0.1" max="5" value="1.1">
              <button id="solveBcrBtn" class="tiny-btn">Solve cost for target BCR</button>
            </div>
            <p class="small" id="whatItTakesNote">
              If the target cannot be reached within the experimental cost range (75,000 to 400,000 rupees per trainee per month), the slider is moved to the nearest feasible value and a note is shown here.
            </p>
          </div>
        </section>
      </div>
    </section>

    <!-- RESULTS TAB -->
    <section id="tab-results" class="tab-section">
      <div class="panel-grid two-col">
        <section class="card">
          <h2>Key results for this configuration</h2>
          <div class="metric-grid">
            <div class="metric-card">
              <div class="metric-label">Endorse FETP option</div>
              <div class="metric-value" id="metricEndorse">0 %</div>
              <div class="metric-footnote">Probability that stakeholders endorse a programme rather than opt out.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Choose opt out</div>
              <div class="metric-value" id="metricOptout">0 %</div>
              <div class="metric-footnote">Probability of preferring no training option at this cost and design.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">FETP graduates (all cohorts)</div>
              <div class="metric-value" id="metricGraduates">0</div>
              <div class="metric-footnote">Trainees per cohort × number of cohorts, adjusted for completion.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Outbreak responses per year</div>
              <div class="metric-value" id="metricOutbreaks">0</div>
              <div class="metric-footnote">Graduates × outbreak response multiplier from Advanced and methods.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Indicative benefit per cohort</div>
              <div class="metric-value" id="metricBenefitPerCohort">INR 0</div>
              <div class="metric-footnote">Based on WTP per trainee per month × duration × trainees × endorsement.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Total economic cost (all cohorts)</div>
              <div class="metric-value" id="metricTotalCost">INR 0</div>
              <div class="metric-footnote">Cost per trainee per month × duration × trainees × cohorts, plus opportunity cost if enabled.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Total benefit (all cohorts)</div>
              <div class="metric-value" id="metricTotalBenefit">INR 0</div>
              <div class="metric-footnote">Indicative economic benefit across all cohorts, using DCE based WTP and endorsement.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Benefit cost ratio</div>
              <div class="metric-value" id="metricBcr">0.00</div>
              <div class="metric-footnote">Total benefit divided by total economic cost.</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Net benefit</div>
              <div class="metric-value" id="metricNetBenefit">INR 0</div>
              <div class="metric-footnote">Total benefit minus total economic cost.</div>
            </div>
          </div>

          <div class="chart-block">
            <h3>Endorsement and opt out</h3>
            <canvas id="endorsementChart" height="140"></canvas>
          </div>

          <div class="chart-block">
            <h3>Costs and benefits per cohort</h3>
            <canvas id="costBenefitChart" height="140"></canvas>
          </div>
        </section>

        <section class="card">
          <h2>How to interpret these numbers</h2>
          <ul class="interpret-list">
            <li><strong>Endorse FETP option</strong> is computed from the DCE utility difference between a configured FETP programme and the opt out option. The model uses the mixed logit or supportive latent class parameters and the cost coefficient that was back transformed from the lognormal cost distribution.</li>
            <li><strong>Choose opt out</strong> is one minus the endorsement probability. When this is high, stakeholders are indicating that they would rather have no programme at the current cost and design.</li>
            <li><strong>FETP graduates (all cohorts)</strong> equals trainees per cohort multiplied by the number of cohorts and the completion rate. Completion can be edited in Advanced and methods.</li>
            <li><strong>Outbreak responses per year</strong> uses a multiplier that translates graduates into additional responses supported per year. This multiplier can be edited in Advanced and methods and should be calibrated with country epidemiologists.</li>
            <li><strong>Indicative benefit per cohort</strong> scales the WTP for programme attributes (per trainee per month in thousand rupees) by the configured attributes, multiplies by duration and trainees, and then weights by endorsement. It should be read as an approximate socio economic value per cohort, not a precise estimate of GDP impact.</li>
            <li><strong>Total economic cost</strong> uses the cost per trainee per month slider, programme duration, trainees, cohorts and optionally the opportunity cost of trainee salaries, informed by the costing templates.</li>
            <li><strong>Total benefit</strong> is the indicative benefit per cohort multiplied by the number of cohorts, using the same WTP based mapping and endorsement probability.</li>
            <li><strong>Benefit cost ratio</strong> and <strong>net benefit</strong> summarise whether benefits outweigh costs under the current configuration. When the ratio exceeds one and net benefit is positive, the configuration is attractive given current assumptions.</li>
          </ul>

          <h3>Briefing text for copy and paste</h3>
          <p class="small">
            This paragraph updates automatically when you change the configuration. It is designed so that you can paste it directly into World Bank or Ministry briefing notes.
          </p>
          <textarea id="briefingText" rows="8" readonly></textarea>
        </section>
      </div>
    </section>

    <!-- COSTING DETAILS TAB -->
    <section id="tab-costing" class="tab-section">
      <div class="panel-grid">
        <section class="card">
          <h2>Cost templates and sources</h2>
          <p>
            Cost templates are based on submissions from WHO, NIE and NCDC. For frontline training,
            WHO supplies a template for six cohorts. For intermediate training, templates are available
            from WHO, NIE and NCDC. For advanced training, templates are available from NIE and NCDC.
          </p>
          <p>
            Templates are used as alternative settings rather than being combined. Policy makers can
            switch between templates to see how cost structure affects economic cost while holding
            programme design constant. Templates that include the opportunity cost of trainee time
            feed into total economic cost when the opportunity cost switch is on.
          </p>
          <p>
            Current template:
            <strong id="costTemplateName">Frontline - WHO template</strong>
          </p>
        </section>

        <section class="card">
          <h2>Cost components for this configuration</h2>
          <p>
            Figures below show programme cost per cohort, the additional opportunity cost of trainee
            time, and a breakdown of programme cost by component for the selected template. All
            amounts are scaled to match the configured cost per trainee per month, duration and number
            of trainees.
          </p>
          <div class="cost-summary-row">
            <div>
              <div class="small-label">Programme cost per cohort (excluding opportunity cost)</div>
              <div id="programmeCostLabel" class="highlight-text">INR 0</div>
            </div>
            <div>
              <div class="small-label">Opportunity cost per cohort</div>
              <div id="oppCostLabel" class="highlight-text">INR 0</div>
            </div>
            <div>
              <div class="small-label">Total economic cost per cohort</div>
              <div id="totalCostPerCohortLabel" class="highlight-text">INR 0</div>
            </div>
          </div>

          <table class="simple-table" id="costComponentsTable">
            <thead>
              <tr>
                <th>Cost component</th>
                <th>Amount per cohort (INR)</th>
              </tr>
            </thead>
            <tbody>
              <!-- filled dynamically -->
            </tbody>
          </table>
        </section>
      </div>
    </section>

    <!-- ATTRIBUTES TAB -->
    <section id="tab-attributes" class="tab-section">
      <div class="panel-grid">
        <section class="card">
          <h2>Attributes and levels in the DCE</h2>
          <p>
            These are the attributes and levels used in the discrete choice experiment that feeds
            into STEPS. The tool uses these definitions behind the scenes when mapping
            configurations into utilities, endorsement and WTP based benefits.
          </p>
          <table class="simple-table">
            <thead>
              <tr>
                <th>Attribute</th>
                <th>Description</th>
                <th>Levels</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Programme type / tier</td>
                <td>Technical tier of FETP training offered and approximate duration.</td>
                <td>Frontline (3 months), Intermediate (12 months), Advanced (24 months)</td>
              </tr>
              <tr>
                <td>Trainee career incentives</td>
                <td>Credentials or pathways obtained on completion.</td>
                <td>Government and partner certificate, University qualification, Government career pathway</td>
              </tr>
              <tr>
                <td>Mentorship intensity</td>
                <td>Number of fellows per mentor, capturing support during training.</td>
                <td>Low (5 or more), Medium (3 to 4), High (2 or fewer)</td>
              </tr>
              <tr>
                <td>Delivery mode</td>
                <td>How training is delivered in practice.</td>
                <td>Blended, Fully in person, Fully online</td>
              </tr>
              <tr>
                <td>Outbreak response capacity</td>
                <td>Time from emergence to response that FETP graduates can support.</td>
                <td>Within 30 days, Within 15 days, Within 7 days</td>
              </tr>
              <tr>
                <td>Cost per trainee per month</td>
                <td>Programme cost per trainee per month in Indian rupees.</td>
                <td>₹ 75,000; 100,000; 250,000; 350,000; 400,000 in the original design</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section class="card">
          <h2>How attributes enter the models</h2>
          <p>
            In the mixed logit and latent class models, these attributes enter as dummy variables,
            with one reference level per attribute. For example, frontline, government and partner
            certificate, low mentorship, blended delivery and 30 day response are the reference
            levels. Coefficients for other levels measure how utility changes relative to those
            references.
          </p>
          <p>
            The alternative specific constant for Training A captures left to right reading bias and
            is not used for policy. The alternative specific constant for the opt out option captures
            a general tendency to avoid training at any cost. Endorsement in STEPS uses the
            difference in utility between the configured programme and the opt out option.
          </p>
        </section>
      </div>
    </section>

    <!-- SIMULATION TAB -->
    <section id="tab-simulation" class="tab-section">
      <div class="panel-grid two-col">
        <section class="card">
          <h2>National simulation</h2>
          <p>
            This view projects national totals for costs, benefits, graduates and outbreaks based on
            your chosen configuration and the number of cohorts.
          </p>
          <div class="metric-grid compact">
            <div class="metric-card">
              <div class="metric-label">Total graduates</div>
              <div class="metric-value" id="simGraduates">0</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Total programme cost</div>
              <div class="metric-value" id="simTotalCost">INR 0</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Total benefit</div>
              <div class="metric-value" id="simTotalBenefit">INR 0</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">National net benefit</div>
              <div class="metric-value" id="simNetBenefit">INR 0</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Outbreak responses per year</div>
              <div class="metric-value" id="simOutbreaks">0</div>
            </div>
          </div>
          <div class="chart-block">
            <h3>National cost and benefit profile</h3>
            <canvas id="simChart" height="140"></canvas>
          </div>
        </section>

        <section class="card">
          <h2>Sensitivity to cost assumptions</h2>
          <p>
            The sensitivity view shows how the benefit cost ratio moves when programme cost is
            20 percent lower or higher than the configured value. This is a simple one parameter
            sensitivity and can be extended if needed.
          </p>
          <div class="chart-block">
            <h3>Benefit cost ratio with ±20 percent cost</h3>
            <canvas id="sensitivityChart" height="140"></canvas>
          </div>
          <p class="small">
            The tool keeps endorsement and WTP based benefits fixed when changing costs in this
            plot. In practice both cost and programme design might change, which can be explored
            by adjusting the configuration directly.
          </p>
        </section>
      </div>
    </section>

    <!-- SAVED SCENARIOS TAB -->
    <section id="tab-saved" class="tab-section">
      <div class="panel-grid">
        <section class="card">
          <h2>Saved scenarios</h2>
          <p>
            Save, tag and shortlist scenarios for discussion. Scenarios are stored in your browser
            while this page is open.
          </p>
          <div class="field-row">
            <label for="scenarioName">Scenario name</label>
            <input type="text" id="scenarioName" placeholder="Example: Advanced, high mentorship, 50 cohorts">
          </div>
          <div class="field-row">
            <label for="scenarioTags">
              Stakeholder tags
              <span class="info-icon" data-tooltip="Short labels such as MoH friendly, Finance preferred, High ambition, Budget neutral.">i</span>
            </label>
            <input type="text" id="scenarioTags" placeholder="MoH friendly; High ambition">
          </div>
          <div class="field-row">
            <label for="scenarioNotes">
              Scenario notes
              <span class="info-icon" data-tooltip="Free text for observations or workshop notes that will appear in exports.">i</span>
            </label>
            <textarea id="scenarioNotes" rows="3" placeholder="Key discussion points, assumptions or caveats."></textarea>
          </div>
          <button id="saveScenarioBtn" class="primary-btn">Save current scenario</button>
        </section>

        <section class="card">
          <h2>Scenario portfolio</h2>
          <div class="saved-actions">
            <button id="downloadExcelBtn" class="secondary-btn">Download scenarios to Excel</button>
            <button id="downloadPdfBtn" class="secondary-btn">Download policy brief PDF</button>
          </div>
          <div class="saved-table-wrapper">
            <table class="simple-table" id="savedScenariosTable">
              <thead>
                <tr>
                  <th>Shortlist</th>
                  <th>Name</th>
                  <th>Tags</th>
                  <th>Tier</th>
                  <th>Mentorship</th>
                  <th>Cohorts</th>
                  <th>Endorsement</th>
                  <th>BCR</th>
                  <th>Total cost (INR)</th>
                  <th>Total benefit (INR)</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>

          <h3>Shortlist comparison</h3>
          <p class="small">
            Use the checkboxes to mark up to five priority scenarios. They will appear in the grid
            below and in the policy brief PDF.
          </p>
          <div class="shortlist-grid" id="shortlistGrid">
            <!-- Filled dynamically -->
          </div>
        </section>
      </div>
    </section>

    <!-- ADVANCED AND METHODS TAB -->
    <section id="tab-advanced" class="tab-section">
      <div class="panel-grid two-col">
        <section class="card">
          <h2>Advanced settings</h2>
          <p>
            These settings control the epidemiological multipliers and exchange rates. They are
            intended for technical users during workshops. Changes affect all calculations
            immediately.
          </p>

          <div class="field-row">
            <label for="multiplierResponses">
              Outbreak responses per graduate per year
              <span class="info-icon" data-tooltip="Rough average number of additional outbreak responses that a single FETP graduate supports each year. Calibrate with local epidemiologists.">i</span>
            </label>
            <input type="number" id="multiplierResponses" min="0" step="0.1" value="0.5">
          </div>

          <div class="field-row">
            <label for="valuePerResponse">
              Economic value per outbreak response (INR)
              <span class="info-icon" data-tooltip="Average economic value attributed to one additional effective outbreak response, covering averted health care costs and productivity losses.">i</span>
            </label>
            <input type="number" id="valuePerResponse" min="0" step="100000" value="2000000">
          </div>

          <div class="field-row">
            <label for="completionRate">
              Expected completion rate (%)
              <span class="info-icon" data-tooltip="Used to adjust the number of graduates. For example 90 means 90 percent of enrolled trainees complete the programme.">i</span>
            </label>
            <input type="number" id="completionRate" min="50" max="100" value="90">
          </div>

          <div class="field-row">
            <label for="exchangeRate">
              INR to USD exchange rate
              <span class="info-icon" data-tooltip="Used only for currency labels when converting totals to USD in exports. All internal calculations remain in INR.">i</span>
            </label>
            <input type="number" id="exchangeRate" min="50" max="150" step="0.5" value="85">
          </div>

          <div class="field-row">
            <label for="oppCostPerMonth">
              Opportunity cost per trainee per month (INR)
              <span class="info-icon" data-tooltip="Average salary per month for a trainee. This is used when the opportunity cost toggle is on. You can calibrate this from the templates or labour market data.">i</span>
            </label>
            <input type="number" id="oppCostPerMonth" min="0" step="5000" value="50000">
          </div>

          <div class="assumption-log">
            <h3>Assumption log</h3>
            <pre id="assumptionLog"></pre>
          </div>
        </section>

        <section class="card scrollable">
          <h2>Methods and technical appendix</h2>
          <p>
            This section summarises the main models and illustrates how STEPS converts
            configurations into endorsement, costs and benefits. It is written for users who want
            to document or adapt the methods.
          </p>

          <h3>1. Utility and endorsement</h3>
          <p>
            For respondent <em>n</em>, alternative <em>j</em> and choice task <em>t</em>, utility is
            decomposed into a systematic component and a random error term:
          </p>
          <p class="equation">
            U<sub>njt</sub> = V<sub>njt</sub> + ε<sub>njt</sub>.
          </p>
          <p>
            The systematic component is specified as a function of attributes and alternative
            specific constants. Training B is the reference alternative and the opt out alternative
            has its own constant. For a generic FETP programme in STEPS, the utility relative to
            the opt out option simplifies to:
          </p>
          <p class="equation">
            V<sub>program</sub> = β<sub>tier</sub> + β<sub>career</sub> + β<sub>mentorship</sub> +
            β<sub>delivery</sub> + β<sub>response</sub> + β<sub>cost</sub> × Cost,
          </p>
          <p class="equation">
            V<sub>opt out</sub> = ASC<sub>opt out</sub>.
          </p>
          <p>
            The alternative specific constant for Training A captures left to right reading bias and
            is not used in policy endorsement calculations. The endorsement probability is then:
          </p>
          <p class="equation">
            P(endorse) = exp(V<sub>program</sub>) / (exp(V<sub>program</sub>) + exp(V<sub>opt out</sub>)).
          </p>
          <p>
            STEPS uses either the average mixed logit coefficients or the Class 2 latent class
            coefficients (training supporters) together with the back transformed mean cost
            coefficient from the lognormal specification. Class 1 (training resisters) has a very
            small and imprecise cost coefficient, so its implied WTP is unstable and is not used for
            policy endorsement.
          </p>

          <h3>2. Cost coefficient and lognormal specification</h3>
          <p>
            In the mixed logit model, the cost coefficient is modelled as a negative lognormal:
          </p>
          <p class="equation">
            β<sub>cost,n</sub> = −exp(μ<sub>cost</sub> + σ<sub>cost</sub> η<sub>n</sub>),
          </p>
          <p>
            where η<sub>n</sub> is standard normal. This constrains the marginal utility of cost to be
            negative for all decision makers and avoids implausible positive cost preferences. The
            back transformed mean cost from your final model is about −0.005 utility units per
            thousand rupees per trainee per month. STEPS uses this as the cost coefficient for
            the average mixed logit model and a value of −0.001 for the supportive latent class,
            consistent with the latent class estimate.
          </p>

          <h3>3. Worked example for endorsement (Results tab)</h3>
          <p>
            Consider a frontline programme with low mentorship, blended delivery, 30 day
            response and cost of INR 165,000 per trainee per month under the mixed logit model.
            All attributes are at the reference level, so only the cost term enters the utility:
          </p>
          <p class="equation">
            V<sub>program</sub> = β<sub>cost</sub> × (Cost / 1000) = −0.005 × 165 = −0.825.
          </p>
          <p>
            The opt out constant is −0.601, so:
          </p>
          <p class="equation">
            P(endorse) = exp(−0.825) / (exp(−0.825) + exp(−0.601)) ≈ 0.44,
          </p>
          <p>
            or about 44 percent endorsement. This number feeds directly into the Endorse FETP
            metric in the Results tab. The Choose opt out metric is one minus this probability.
          </p>

          <h3>4. WTP and indicative benefits (Results and Simulation tabs)</h3>
          <p>
            For each non cost attribute level the DCE provides an estimated WTP measured in
            thousand rupees per trainee per month. For example, under the mixed logit model:
          </p>
          <ul>
            <li>Advanced tier relative to frontline: about 104 thousand per trainee per month.</li>
            <li>High mentorship relative to low: about 137 thousand per trainee per month.</li>
            <li>Moving from 30 days to 7 days response: about 130 thousand per trainee per month.</li>
          </ul>
          <p>
            STEPS sums the WTP for all selected levels that differ from the reference to obtain
            an indicative WTP per trainee per month. This is multiplied by the duration of the
            programme and the number of trainees per cohort, and then weighted by the
            endorsement probability:
          </p>
          <p class="equation">
            Benefit per cohort = WTP<sub>per trainee per month</sub> × duration × trainees × P(endorse).
          </p>
          <p>
            This value appears as Indicative benefit per cohort in the Results tab and is scaled to
            Total benefit in the National simulation tab by multiplying with the number of cohorts.
          </p>

          <h3>5. Costs and net benefit: worked example (Costing and Results tabs)</h3>
          <p>
            Suppose you consider an advanced programme with high mentorship, blended delivery
            and 7 day response, cost of INR 250,000 per trainee per month, 20 trainees per cohort,
            24 months, and 10 cohorts. The economic cost per cohort is:
          </p>
          <p class="equation">
            Programme cost per cohort = 250,000 × 24 × 20 = INR 120,000,000.
          </p>
          <p>
            If you set the opportunity cost per trainee per month to INR 50,000 and keep the
            opportunity cost switch on, the opportunity cost per cohort is:
          </p>
          <p class="equation">
            Opportunity cost per cohort = 50,000 × 24 × 20 = INR 24,000,000.
          </p>
          <p>
            Total economic cost per cohort is then INR 144,000,000. These values appear in the
            Costing details tab as Programme cost per cohort, Opportunity cost per cohort and
            Total economic cost per cohort.
          </p>

          <h3>6. Cost templates and component breakdown (Costing tab)</h3>
          <p>
            The cost templates from WHO, NIE and NCDC define how programme cost is split across
            components such as staff salaries, travel, workshops and facility costs. STEPS first
            computes cost shares from the templates and then scales those shares to match the
            configured programme cost per cohort. Opportunity cost is added separately based on
            the advanced setting for opportunity cost per trainee per month.
          </p>
          <p>
            The Costing tab lists components such as In country programme staff, Office equipment,
            Workshops and seminars and In country travel together with the implied rupee amount
            for the current configuration. These components sum to the programme cost per cohort
            shown at the top of the tab.
          </p>

          <h3>7. Latent class model and supportive group (Configuration and Results tabs)</h3>
          <p>
            The two class latent class model separates decision makers into training resisters and
            training supporters. Class 1 has a large positive opt out constant and essentially zero
            cost sensitivity, so implied WTP is very unstable. Class 2 has a strongly negative opt
            out constant, a negative cost coefficient and coherent WTP estimates. The supportive
            group option in STEPS applies the Class 2 parameters to compute endorsement and
            WTP based benefits, allowing users to see scenarios that are attractive for engaged
            stakeholders even if some actors remain sceptical.
          </p>

          <h3>8. National simulation and sensitivity: worked example</h3>
          <p>
            The National simulation tab takes the same graduates, total cost and total benefit that
            are displayed in the Results tab and presents them as national aggregates. For example,
            if a configuration produces 50 graduates per cohort and there are 20 cohorts, total
            graduates will be 1,000. If total cost is INR 1,200,000,000 and total benefit is
            INR 1,500,000,000, the national net benefit is INR 300,000,000.
          </p>
          <p>
            The sensitivity chart then evaluates the benefit cost ratio when costs are 20 percent
            lower and 20 percent higher, holding benefits fixed. This gives users a quick view of
            how sensitive conclusions are to cost uncertainty.
          </p>

          <h3>9. Saved scenarios and shortlist portfolio</h3>
          <p>
            The Saved scenarios tab stores configurations and their results for discussion. Each
            scenario keeps its tier, mentorship, cost, endorsement, benefit cost ratio, total cost,
            total benefit and notes. Shortlisted scenarios appear in a compact grid and in the
            policy brief PDF. This makes it easy to agree on a portfolio of two or three priority
            options at the end of a workshop.
          </p>

          <h3>10. What would it take back solver</h3>
          <p>
            The endorsement solver in the Configuration tab starts from a requested endorsement
            level and inverts the logit formula for the configured attributes and opt out constant.
            It then computes the cost per trainee per month that yields the requested endorsement.
            If the required cost lies outside the experimental range, the slider moves to the closest
            feasible value and a note is shown.
          </p>
          <p>
            The benefit cost ratio solver searches over values of cost per trainee per month within
            the slider range to find a cost that produces the requested ratio, given the current
            benefit calculation. It adjusts only cost and leaves programme design unchanged so that
            policy makers can see what level of cost control would be needed to reach a given
            benchmark.
          </p>

          <h3>11. Exporting methods for reports</h3>
          <p>
            When you download the policy brief PDF, the tool inserts a short methods paragraph
            that references the mixed logit and latent class models, the use of WTP for mapping
            attributes into benefits, and the way costs are constructed from per trainee per month
            costs and cost templates. The briefing text box in the Results tab provides a shorter,
            plain language version suitable for quick paste into briefing notes.
          </p>

          <p class="small">
            Lead contact: <strong>Mesfin Genie, PhD, Newcastle Business School, The University of Newcastle, Australia</strong><br>
            Email: <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>
          </p>
        </section>
      </div>
    </section>
  </main>

  <!-- RESULTS MODAL -->
  <div id="resultsModal" class="modal-backdrop hidden">
    <div class="modal">
      <button class="modal-close" id="closeResultsModal">×</button>
      <h2>Scenario summary</h2>
      <div id="modalScenarioSummary"></div>
    </div>
  </div>

  <!-- TOUR MODAL -->
  <div id="tourModal" class="modal-backdrop hidden">
    <div class="modal">
      <button class="modal-close" id="closeTourModal">×</button>
      <h2 id="tourTitle">Welcome to STEPS</h2>
      <div id="tourBody"></div>
      <div class="tour-actions">
        <button id="tourSkipBtn" class="secondary-btn">Skip</button>
        <button id="tourNextBtn" class="primary-btn">Next</button>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast hidden"></div>
</div>

<script src="script.js"></script>
</body>
</html>
